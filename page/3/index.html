<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="成长源于经历的点点滴滴">
<meta property="og:type" content="website">
<meta property="og:title" content="谦和斋">
<meta property="og:url" content="http://jefferlau.me/page/3/index.html">
<meta property="og:site_name" content="谦和斋">
<meta property="og:description" content="成长源于经历的点点滴滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谦和斋">
<meta name="twitter:description" content="成长源于经历的点点滴滴">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jefferlau.me/page/3/"/>





  <title>谦和斋</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?58386307b8e0d732d7f273ee52113aca";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">谦和斋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">写代码的厨房</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/07/09/转载-使用-Maven-将-Spring-项目打成独立执行的jar文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/09/转载-使用-Maven-将-Spring-项目打成独立执行的jar文件/" itemprop="url">[转载]使用 Maven 将 Spring 项目打成独立执行的jar文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-09T23:23:47+08:00">
                2016-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Maven/" itemprop="url" rel="index">
                    <span itemprop="name">Maven</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/07/09/转载-使用-Maven-将-Spring-项目打成独立执行的jar文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/07/09/转载-使用-Maven-将-Spring-项目打成独立执行的jar文件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/07/09/转载-使用-Maven-将-Spring-项目打成独立执行的jar文件/" class="leancloud_visitors" data-flag-title="[转载]使用 Maven 将 Spring 项目打成独立执行的jar文件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Maven可以使用mvn package指令对项目进行打包生成jar文件，如果直接使用java -jar xxx.jar指令运行jar文件，会出现”no main manifest attribute, in xxx.jar”（没有设置Main-Class）、ClassNotFoundException（找不到依赖包）等错误。<br>要想jar包能直接通过java -jar xxx.jar运行，需要满足：<br>1、在jar包中的META-INF/MANIFEST.MF中指定Main-Class，这样才能确定程序的入口在哪里；<br>2、要能加载到依赖包。<br>使用Maven有以下几种方法可以生成满足以上两个条件能直接运行的jar包，可以根据需要选择一种合适的方法。<br>方法一：使用maven-jar-plugin和maven-dependency-plugin插件打包<br>在pom.xml中配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xxg.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>maven-jar-plugin用于生成META-INF/MANIFEST.MF文件的部分内容，<mainclass>com.xxg.Main</mainclass>指定MANIFEST.MF中的Main-Class，<addclasspath>true</addclasspath>会在MANIFEST.MF加上Class-Path项并配置依赖包，<classpathprefix>lib/</classpathprefix>指定依赖包所在目录。<br>例如下面是一个通过maven-jar-plugin插件生成的MANIFEST.MF文件片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Class-Path: lib/commons-logging-1.2.jar lib/commons-io-2.4.jar</div><div class="line">Main-Class: com.xxg.Main</div></pre></td></tr></table></figure>
<p>不过仅仅生成MANIFEST.MF文件还不够，maven-dependency-plugin插件用于将依赖包拷贝到<outputdirectory>${project.build.directory}/lib</outputdirectory>指定的位置，即lib目录下。<br>配置完成后，通过mvn package指令打包，会在target目录下生成jar包，并将依赖包拷贝到target/lib目录下<br>指定了Main-Class，有了依赖包，那么就可以直接通过java -jar xxx.jar运行jar包。<br>不过这种方式生成jar包有个缺点，就是生成的jar包太多不便于管理，下面两种方式只生成单个jar文件，包含项目本身的代码、资源以及所有的依赖包。<br>方法二：使用maven-assembly-plugin插件打包<br>在pom.xml中配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xxg.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p>打包方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn package assembly:single</div></pre></td></tr></table></figure>
<p>打包后会在target目录下生成一个xxx-jar-with-dependencies.jar文件，这个文件不但包含了自己项目中的代码和资源，还包含了所有依赖包的内容。所以可以直接通过java -jar来运行。<br>此外还可以直接通过mvn package来打包，无需assembly:single，不过需要加上一些配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;build&gt;</div><div class="line">    &lt;plugins&gt;</div><div class="line"></div><div class="line">        &lt;plugin&gt;</div><div class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;2.5.5&lt;/version&gt;</div><div class="line">            &lt;configuration&gt;</div><div class="line">                &lt;archive&gt;</div><div class="line">                    &lt;manifest&gt;</div><div class="line">                        &lt;mainClass&gt;com.xxg.Main&lt;/mainClass&gt;</div><div class="line">                    &lt;/manifest&gt;</div><div class="line">                &lt;/archive&gt;</div><div class="line">                &lt;descriptorRefs&gt;</div><div class="line">                    &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</div><div class="line">                &lt;/descriptorRefs&gt;</div><div class="line">            &lt;/configuration&gt;</div><div class="line">            &lt;executions&gt;</div><div class="line">                &lt;execution&gt;</div><div class="line">                    &lt;id&gt;make-assembly&lt;/id&gt;</div><div class="line">                    &lt;phase&gt;package&lt;/phase&gt;</div><div class="line">                    &lt;goals&gt;</div><div class="line">                        &lt;goal&gt;single&lt;/goal&gt;</div><div class="line">                    &lt;/goals&gt;</div><div class="line">                &lt;/execution&gt;</div><div class="line">            &lt;/executions&gt;</div><div class="line">        &lt;/plugin&gt;</div><div class="line"></div><div class="line">    &lt;/plugins&gt;</div><div class="line">&lt;/build&gt;</div></pre></td></tr></table></figure>
<p>其中<phase>package</phase>、<goal>single</goal>表示在执行package打包时，执行assembly:single，所以可以直接使用mvn package打包。<br>不过，如果项目中用到Spring Framework，用这种方式打出来的包运行时会出现读取XML schema文件异常等奇怪的错误，使用下面的方法三可以处理。<br>方法三：使用maven-shade-plugin插件打包<br>在pom.xml中配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xxg.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p>配置完成后，执行mvn package即可打包。在target目录下会生成两个jar包，注意不是original-xxx.jar文件，而是另外一个。和maven-assembly-plugin一样，生成的jar文件包含了所有依赖，所以可以直接运行。<br>不过如果项目中用到了Spring Framework，将依赖打到一个jar包中，运行时会出现读取XML schema文件出错。原因是Spring Framework的多个jar包中包含相同的文件spring.handlers和spring.schemas，如果生成单个jar包会互相覆盖。为了避免互相影响，可以使用AppendingTransformer来对文件内容追加合并：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xxg.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">"org.apache.maven.plugins.shade.resource.AppendingTransformer"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.handlers<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">"org.apache.maven.plugins.shade.resource.AppendingTransformer"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.schemas<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p><a href="http://xxgblog.com/2015/08/07/maven-create-executable-jar/" target="_blank" rel="external">原文链接</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/07/03/git-extras-增强功能命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/03/git-extras-增强功能命令/" itemprop="url">git-extras 增强功能命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-03T10:54:59+08:00">
                2016-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/07/03/git-extras-增强功能命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/07/03/git-extras-增强功能命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/07/03/git-extras-增强功能命令/" class="leancloud_visitors" data-flag-title="git-extras 增强功能命令">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不同平台的安装请参考 <a href="https://github.com/tj/git-extras/blob/master/Installation.md" target="_blank" rel="external">Installation</a>。</p>
<p>常用的几个增强功能：</p>
<ul>
<li>git summary(显示项目的统计信息)</li>
<li>git effort(统计文件的修改信息)</li>
<li>git count(统计提交信息)</li>
<li>git alias (命令别名)</li>
<li>git ignore (添加忽略)</li>
<li>git info (类型svn info，显示repo和git配置)</li>
<li>git fork (fork)</li>
<li>git release (release)</li>
<li>git local-commits (#本地提交信息)</li>
<li>git pr (切换到pr)</li>
<li>git root (返回root目录)</li>
<li>git delta (显示变更信息)</li>
</ul>
<p>命令列表：</p>
<p><a href="https://github.com/tj/git-extras/blob/master/Commands.md" target="_blank" rel="external">https://github.com/tj/git-extras/blob/master/Commands.md</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/25/转载-MySQL索引原理及慢查询优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/25/转载-MySQL索引原理及慢查询优化/" itemprop="url">[转载]MySQL索引原理及慢查询优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-25T18:12:14+08:00">
                2016-06-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/25/转载-MySQL索引原理及慢查询优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/25/转载-MySQL索引原理及慢查询优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/25/转载-MySQL索引原理及慢查询优化/" class="leancloud_visitors" data-flag-title="[转载]MySQL索引原理及慢查询优化">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://tech.meituan.com/mysql-index.html" target="_blank" rel="external">原文地址：http://tech.meituan.com/mysql-index.html</a></p>
<p>MySQL凭借着出色的性能、低廉的成本、丰富的资源，已经成为绝大多数互联网公司的首选关系型数据库。虽然性能出色，但所谓“好马配好鞍”，如何能够更好的使用它，已经成为开发工程师的必修课，我们经常会从职位描述上看到诸如“精通MySQL”、“SQL语句优化”、“了解数据库原理”等要求。我们知道一般的应用系统，读写比例在10:1左右，而且插入操作和一般的更新操作很少出现性能问题，遇到最多的，也是最容易出问题的，还是一些复杂的查询操作，所以查询语句的优化显然是重中之重。<br>本人从13年7月份起，一直在美团核心业务系统部做慢查询的优化工作，共计十余个系统，累计解决和积累了上百个慢查询案例。随着业务的复杂性提升，遇到的问题千奇百怪，五花八门，匪夷所思。本文旨在以开发工程师的角度来解释数据库索引的原理和如何优化慢查询。</p>
<h1 id="一个慢查询引发的思考"><a href="#一个慢查询引发的思考" class="headerlink" title="一个慢查询引发的思考"></a>一个慢查询引发的思考</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   <span class="keyword">count</span>(*) </div><div class="line"><span class="keyword">from</span></div><div class="line">   task </div><div class="line"><span class="keyword">where</span></div><div class="line">   <span class="keyword">status</span>=<span class="number">2</span> </div><div class="line">   <span class="keyword">and</span> operator_id=<span class="number">20839</span> </div><div class="line">   <span class="keyword">and</span> operate_time&gt;<span class="number">1371169729</span> </div><div class="line">   <span class="keyword">and</span> operate_time&lt;<span class="number">1371174603</span> </div><div class="line">   <span class="keyword">and</span> <span class="keyword">type</span>=<span class="number">2</span>;</div></pre></td></tr></table></figure>
<p>系统使用者反应有一个功能越来越慢，于是工程师找到了上面的SQL。<br>并且兴致冲冲的找到了我，“这个SQL需要优化，给我把每个字段都加上索引”<br>我很惊讶，问道“为什么需要每个字段都加上索引？”<br>“把查询的字段都加上索引会更快”工程师信心满满<br>“这种情况完全可以建一个联合索引，因为是最左前缀匹配，所以operate_time需要放到最后，而且还需要把其他相关的查询都拿来，需要做一个综合评估。”<br>“联合索引？最左前缀匹配？综合评估？”工程师不禁陷入了沉思。<br>多数情况下，我们知道索引能够提高查询效率，但应该如何建立索引？索引的顺序如何？许多人却只知道大概。其实理解这些概念并不难，而且索引的原理远没有想象的那么复杂。</p>
<h1 id="MySQL索引原理"><a href="#MySQL索引原理" class="headerlink" title="MySQL索引原理"></a>MySQL索引原理</h1><h2 id="索引目的"><a href="#索引目的" class="headerlink" title="索引目的"></a>索引目的</h2><p>索引的目的在于提高查询效率，可以类比字典，如果要查“mysql”这个单词，我们肯定需要定位到m字母，然后从下往下找到y字母，再找到剩下的sql。如果没有索引，那么你可能需要把所有单词看一遍才能找到你想要的，如果我想找到m开头的单词呢？或者ze开头的单词呢？是不是觉得如果没有索引，这个事情根本无法完成？</p>
<h2 id="索引原理"><a href="#索引原理" class="headerlink" title="索引原理"></a>索引原理</h2><p>除了词典，生活中随处可见索引的例子，如火车站的车次表、图书的目录等。它们的原理都是一样的，通过不断的缩小想要获得数据的范围来筛选出最终想要的结果，同时把随机的事件变成顺序的事件，也就是我们总是通过同一种查找方式来锁定数据。<br>数据库也是一样，但显然要复杂许多，因为不仅面临着等值查询，还有范围查询(&gt;、&lt;、between、in)、模糊查询(like)、并集查询(or)等等。数据库应该选择怎么样的方式来应对所有的问题呢？我们回想字典的例子，能不能把数据分成段，然后分段查询呢？最简单的如果1000条数据，1到100分成第一段，101到200分成第二段，201到300分成第三段……这样查第250条数据，只要找第三段就可以了，一下子去除了90%的无效数据。但如果是1千万的记录呢，分成几段比较好？稍有算法基础的同学会想到搜索树，其平均复杂度是lgN，具有不错的查询性能。但这里我们忽略了一个关键的问题，复杂度模型是基于每次相同的操作成本来考虑的，数据库实现比较复杂，数据保存在磁盘上，而为了提高性能，每次又可以把部分数据读入内存来计算，因为我们知道访问磁盘的成本大概是访问内存的十万倍左右，所以简单的搜索树难以满足复杂的应用场景。</p>
<h3 id="磁盘IO与预读"><a href="#磁盘IO与预读" class="headerlink" title="磁盘IO与预读"></a>磁盘IO与预读</h3><p>前面提到了访问磁盘，那么这里先简单介绍一下磁盘IO和预读，磁盘读取数据靠的是机械运动，每次读取数据花费的时间可以分为寻道时间、旋转延迟、传输时间三个部分，寻道时间指的是磁臂移动到指定磁道所需要的时间，主流磁盘一般在5ms以下；旋转延迟就是我们经常听说的磁盘转速，比如一个磁盘7200转，表示每分钟能转7200次，也就是说1秒钟能转120次，旋转延迟就是1/120/2 = 4.17ms；传输时间指的是从磁盘读出或将数据写入磁盘的时间，一般在零点几毫秒，相对于前两个时间可以忽略不计。那么访问一次磁盘的时间，即一次磁盘IO的时间约等于5+4.17 = 9ms左右，听起来还挺不错的，但要知道一台500 -MIPS的机器每秒可以执行5亿条指令，因为指令依靠的是电的性质，换句话说执行一次IO的时间可以执行40万条指令，数据库动辄十万百万乃至千万级数据，每次9毫秒的时间，显然是个灾难。下图是计算机硬件延迟的对比图，供大家参考：</p>
<img src="/images/2016/06/25/various-system-software-hardware-latencies.png" class="[class names]" width="548" height="321" title="计算机硬件延迟的对比图">
<p>考虑到磁盘IO是非常高昂的操作，计算机操作系统做了一些优化，当一次IO时，不光把当前磁盘地址的数据，而是把相邻的数据也都读取到内存缓冲区内，因为局部预读性原理告诉我们，当计算机访问一个地址的数据的时候，与其相邻的数据也会很快被访问到。每一次IO读取的数据我们称之为一页(page)。具体一页有多大数据跟操作系统有关，一般为4k或8k，也就是我们读取一页内的数据时候，实际上才发生了一次IO，这个理论对于索引的数据结构设计非常有帮助。</p>
<h3 id="索引的数据结构"><a href="#索引的数据结构" class="headerlink" title="索引的数据结构"></a>索引的数据结构</h3><p>前面讲了生活中索引的例子，索引的基本原理，数据库的复杂性，又讲了操作系统的相关知识，目的就是让大家了解，任何一种数据结构都不是凭空产生的，一定会有它的背景和使用场景，我们现在总结一下，我们需要这种数据结构能够做些什么，其实很简单，那就是：每次查找数据时把磁盘IO次数控制在一个很小的数量级，最好是常数数量级。那么我们就想到如果一个高度可控的多路搜索树是否能满足需求呢？就这样，b+树应运而生。</p>
<h3 id="详解b-树"><a href="#详解b-树" class="headerlink" title="详解b+树"></a>详解b+树</h3><img src="/images/2016/06/25/btree.jpg" class="[class names]" width="624" height="300" title="b+树">
<p>如上图，是一颗b+树，关于b+树的定义可以参见<a href="http://zh.wikipedia.org/wiki/B%2B%E6%A0%91" target="_blank" rel="external">B+树</a>，这里只说一些重点，浅蓝色的块我们称之为一个磁盘块，可以看到每个磁盘块包含几个数据项（深蓝色所示）和指针（黄色所示），如磁盘块1包含数据项17和35，包含指针P1、P2、P3，P1表示小于17的磁盘块，P2表示在17和35之间的磁盘块，P3表示大于35的磁盘块。真实的数据存在于叶子节点即3、5、9、10、13、15、28、29、36、60、75、79、90、99。非叶子节点只不存储真实的数据，只存储指引搜索方向的数据项，如17、35并不真实存在于数据表中。</p>
<h3 id="b-树的查找过程"><a href="#b-树的查找过程" class="headerlink" title="b+树的查找过程"></a>b+树的查找过程</h3><p>如图所示，如果要查找数据项29，那么首先会把磁盘块1由磁盘加载到内存，此时发生一次IO，在内存中用二分查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短（相比磁盘的IO）可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO，29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分查找找到29，结束查询，总计三次IO。真实的情况是，3层的b+树可以表示上百万的数据，如果上百万的数据查找只需要三次IO，性能提高将是巨大的，如果没有索引，每个数据项都要发生一次IO，那么总共需要百万次的IO，显然成本非常非常高。</p>
<h3 id="b-树性质"><a href="#b-树性质" class="headerlink" title="b+树性质"></a>b+树性质</h3><ol>
<li>通过上面的分析，我们知道IO次数取决于b+数的高度h，假设当前数据表的数据为N，每个磁盘块的数据项的数量是m，则有h=㏒(m+1)N，当数据量N一定的情况下，m越大，h越小；而m = 磁盘块的大小 / 数据项的大小，磁盘块的大小也就是一个数据页的大小，是固定的，如果数据项占的空间越小，数据项的数量越多，树的高度越低。这就是为什么每个数据项，即索引字段要尽量的小，比如int占4字节，要比bigint8字节少一半。这也是为什么b+树要求把真实的数据放到叶子节点而不是内层节点，一旦放到内层节点，磁盘块的数据项会大幅度下降，导致树增高。当数据项等于1时将会退化成线性表。</li>
<li>当b+树的数据项是复合的数据结构，比如(name,age,sex)的时候，b+数是按照从左到右的顺序来建立搜索树的，比如当(张三,20,F)这样的数据来检索的时候，b+树会优先比较name来确定下一步的所搜方向，如果name相同再依次比较age和sex，最后得到检索的数据；但当(20,F)这样的没有name的数据来的时候，b+树就不知道下一步该查哪个节点，因为建立搜索树的时候name就是第一个比较因子，必须要先根据name来搜索才能知道下一步去哪里查询。比如当(张三,F)这样的数据来检索时，b+树可以用name来指定搜索方向，但下一个字段age的缺失，所以只能把名字等于张三的数据都找到，然后再匹配性别是F的数据了， 这个是非常重要的性质，即索引的最左匹配特性。</li>
</ol>
<h1 id="慢查询优化"><a href="#慢查询优化" class="headerlink" title="慢查询优化"></a>慢查询优化</h1><p>关于MySQL索引原理是比较枯燥的东西，大家只需要有一个感性的认识，并不需要理解得非常透彻和深入。我们回头来看看一开始我们说的慢查询，了解完索引原理之后，大家是不是有什么想法呢？先总结一下索引的几大基本原则</p>
<h2 id="建索引的几大原则"><a href="#建索引的几大原则" class="headerlink" title="建索引的几大原则"></a>建索引的几大原则</h2><ol>
<li>最左前缀匹配原则，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</li>
<li>=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式</li>
<li>尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录</li>
<li>索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</li>
<li>尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可</li>
</ol>
<h2 id="回到开始的慢查询"><a href="#回到开始的慢查询" class="headerlink" title="回到开始的慢查询"></a>回到开始的慢查询</h2><p>根据最左匹配原则，最开始的sql语句的索引应该是status、operator_id、type、operate_time的联合索引；其中status、operator_id、type的顺序可以颠倒，所以我才会说，把这个表的所有相关查询都找到，会综合分析；<br>比如还有如下查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> task <span class="keyword">where</span> <span class="keyword">status</span> = <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">type</span> = <span class="number">12</span> <span class="keyword">limit</span> <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> task <span class="keyword">where</span> <span class="keyword">status</span> = <span class="number">0</span> ;</div></pre></td></tr></table></figure>
<p>那么索引建立成(status,type,operator_id,operate_time)就是非常正确的，因为可以覆盖到所有情况。这个就是利用了索引的最左匹配的原则</p>
<h2 id="查询优化神器-explain命令"><a href="#查询优化神器-explain命令" class="headerlink" title="查询优化神器 - explain命令"></a>查询优化神器 - explain命令</h2><p>关于explain命令相信大家并不陌生，具体用法和字段含义可以参考官网<a href="http://dev.mysql.com/doc/refman/5.5/en/explain-output.html" target="_blank" rel="external">explain-output</a>，这里需要强调rows是核心指标，绝大部分rows小的语句执行一定很快（有例外，下面会讲到）。所以优化语句基本上都是在优化rows。</p>
<h2 id="慢查询优化基本步骤"><a href="#慢查询优化基本步骤" class="headerlink" title="慢查询优化基本步骤"></a>慢查询优化基本步骤</h2><ol>
<li>先运行看看是否真的很慢，注意设置SQL_NO_CACHE</li>
<li>where条件单表查，锁定最小返回记录表。这句话的意思是把查询语句的where都应用到表中返回的记录数最小的表开始查起，单表每个字段分别查询，看哪个字段的区分度最高</li>
<li>explain查看执行计划，是否与1预期一致（从锁定记录较少的表开始查询）</li>
<li>order by limit 形式的sql语句让排序的表优先查</li>
<li>了解业务方使用场景</li>
<li>加索引时参照建索引的几大原则</li>
<li>观察结果，不符合预期继续从0分析</li>
</ol>
<h1 id="几个慢查询案例"><a href="#几个慢查询案例" class="headerlink" title="几个慢查询案例"></a>几个慢查询案例</h1><p>下面几个例子详细解释了如何分析和优化慢查询</p>
<h2 id="复杂语句写法"><a href="#复杂语句写法" class="headerlink" title="复杂语句写法"></a>复杂语句写法</h2><p>很多情况下，我们写SQL只是为了实现功能，这只是第一步，不同的语句书写方式对于效率往往有本质的差别，这要求我们对mysql的执行计划和索引原则有非常清楚的认识，请看下面的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   <span class="keyword">distinct</span> cert.emp_id </div><div class="line"><span class="keyword">from</span></div><div class="line">   cm_log cl </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   (</div><div class="line">      <span class="keyword">select</span></div><div class="line">         emp.id <span class="keyword">as</span> emp_id,</div><div class="line">         emp_cert.id <span class="keyword">as</span> cert_id </div><div class="line">      <span class="keyword">from</span></div><div class="line">         employee emp </div><div class="line">      <span class="keyword">left</span> <span class="keyword">join</span></div><div class="line">         emp_certificate emp_cert </div><div class="line">            <span class="keyword">on</span> emp.id = emp_cert.emp_id </div><div class="line">      <span class="keyword">where</span></div><div class="line">         emp.is_deleted=<span class="number">0</span></div><div class="line">   ) cert </div><div class="line">      <span class="keyword">on</span> (</div><div class="line">         cl.ref_table=<span class="string">'Employee'</span> </div><div class="line">         <span class="keyword">and</span> cl.ref_oid= cert.emp_id</div><div class="line">      ) </div><div class="line">      <span class="keyword">or</span> (</div><div class="line">         cl.ref_table=<span class="string">'EmpCertificate'</span> </div><div class="line">         <span class="keyword">and</span> cl.ref_oid= cert.cert_id</div><div class="line">      ) </div><div class="line"><span class="keyword">where</span></div><div class="line">   cl.last_upd_date &gt;=<span class="string">'2013-11-07 15:03:00'</span> </div><div class="line">   <span class="keyword">and</span> cl.last_upd_date&lt;=<span class="string">'2013-11-08 16:00:00'</span>;</div></pre></td></tr></table></figure>
<p>0.先运行一下，53条记录 1.87秒，又没有用聚合语句，比较慢</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">53 rows in <span class="keyword">set</span> (<span class="number">1.87</span> sec)</div></pre></td></tr></table></figure>
<p>2.explain</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</div><div class="line">| id | select_type | table      | type  | possible_keys                   | key                   | key_len | ref               | rows  | Extra                          |</div><div class="line">+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</div><div class="line">|  1 | PRIMARY     | cl         | range | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date     | 8       | NULL              |   379 | Using where; Using temporary   |</div><div class="line">|  1 | PRIMARY     | &lt;derived2&gt; | ALL   | NULL                            | NULL                  | NULL    | NULL              | 63727 | Using where; Using join buffer |</div><div class="line">|  2 | DERIVED     | emp        | ALL   | NULL                            | NULL                  | NULL    | NULL              | 13317 | Using where                    |</div><div class="line">|  2 | DERIVED     | emp_cert   | ref   | emp_certificate_empid           | emp_certificate_empid | 4       | meituanorg.emp.id |     1 | Using index                    |</div><div class="line">+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+</div></pre></td></tr></table></figure>
<p>简述一下执行计划，首先mysql根据idx_last_upd_date索引扫描cm_log表获得379条记录；然后查表扫描了63727条记录，分为两部分，derived表示构造表，也就是不存在的表，可以简单理解成是一个语句形成的结果集，后面的数字表示语句的ID。derived2表示的是ID = 2的查询构造了虚拟表，并且返回了63727条记录。我们再来看看ID = 2的语句究竟做了写什么返回了这么大量的数据，首先全表扫描employee表13317条记录，然后根据索引emp_certificate_empid关联emp_certificate表，rows = 1表示，每个关联都只锁定了一条记录，效率比较高。获得后，再和cm_log的379条记录根据规则关联。从执行过程上可以看出返回了太多的数据，返回的数据绝大部分cm_log都用不到，因为cm_log只锁定了379条记录。</p>
<p>如何优化呢？可以看到我们在运行完后还是要和cm_log做join,那么我们能不能之前和cm_log做join呢？仔细分析语句不难发现，其基本思想是如果cm_log的ref_table是EmpCertificate就关联emp_certificate表，如果ref_table是Employee就关联employee表，我们完全可以拆成两部分，并用union连接起来，注意这里用union，而不用union all是因为原语句有“distinct”来得到唯一的记录，而union恰好具备了这种功能。如果原语句中没有distinct不需要去重，我们就可以直接使用union all了，因为使用union需要去重的动作，会影响SQL性能。</p>
<p>优化过的语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   emp.id </div><div class="line"><span class="keyword">from</span></div><div class="line">   cm_log cl </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   employee emp </div><div class="line">      <span class="keyword">on</span> cl.ref_table = <span class="string">'Employee'</span> </div><div class="line">      <span class="keyword">and</span> cl.ref_oid = emp.id  </div><div class="line"><span class="keyword">where</span></div><div class="line">   cl.last_upd_date &gt;=<span class="string">'2013-11-07 15:03:00'</span> </div><div class="line">   <span class="keyword">and</span> cl.last_upd_date&lt;=<span class="string">'2013-11-08 16:00:00'</span> </div><div class="line">   <span class="keyword">and</span> emp.is_deleted = <span class="number">0</span>  </div><div class="line"><span class="keyword">union</span></div><div class="line"><span class="keyword">select</span></div><div class="line">   emp.id </div><div class="line"><span class="keyword">from</span></div><div class="line">   cm_log cl </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   emp_certificate ec </div><div class="line">      <span class="keyword">on</span> cl.ref_table = <span class="string">'EmpCertificate'</span> </div><div class="line">      <span class="keyword">and</span> cl.ref_oid = ec.id  </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   employee emp </div><div class="line">      <span class="keyword">on</span> emp.id = ec.emp_id  </div><div class="line"><span class="keyword">where</span></div><div class="line">   cl.last_upd_date &gt;=<span class="string">'2013-11-07 15:03:00'</span> </div><div class="line">   <span class="keyword">and</span> cl.last_upd_date&lt;=<span class="string">'2013-11-08 16:00:00'</span> </div><div class="line">   <span class="keyword">and</span> emp.is_deleted = <span class="number">0</span></div></pre></td></tr></table></figure>
<p>4.不需要了解业务场景，只需要改造的语句和改造之前的语句保持结果一致<br>5.现有索引可以满足，不需要建索引<br>6.用改造后的语句实验一下，只需要10ms 降低了近200倍！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</div><div class="line">| id | select_type  | table      | type   | possible_keys                   | key               | key_len | ref                   | rows | Extra       |</div><div class="line">+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</div><div class="line">|  1 | PRIMARY      | cl         | range  | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date | 8       | NULL                  |  379 | Using where |</div><div class="line">|  1 | PRIMARY      | emp        | eq_ref | PRIMARY                         | PRIMARY           | 4       | meituanorg.cl.ref_oid |    1 | Using where |</div><div class="line">|  2 | UNION        | cl         | range  | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date | 8       | NULL                  |  379 | Using where |</div><div class="line">|  2 | UNION        | ec         | eq_ref | PRIMARY,emp_certificate_empid   | PRIMARY           | 4       | meituanorg.cl.ref_oid |    1 |             |</div><div class="line">|  2 | UNION        | emp        | eq_ref | PRIMARY                         | PRIMARY           | 4       | meituanorg.ec.emp_id  |    1 | Using where |</div><div class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL    | NULL                            | NULL              | NULL    | NULL                  | NULL |             |</div><div class="line">+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+</div><div class="line">53 rows in set (0.01 sec)</div></pre></td></tr></table></figure>
<h2 id="明确应用场景"><a href="#明确应用场景" class="headerlink" title="明确应用场景"></a>明确应用场景</h2><p>举这个例子的目的在于颠覆我们对列的区分度的认知，一般上我们认为区分度越高的列，越容易锁定更少的记录，但在一些特殊的情况下，这种理论是有局限性的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   * </div><div class="line"><span class="keyword">from</span></div><div class="line">   stage_poi sp </div><div class="line"><span class="keyword">where</span></div><div class="line">   sp.accurate_result=<span class="number">1</span> </div><div class="line">   <span class="keyword">and</span> (</div><div class="line">      sp.sync_status=<span class="number">0</span> </div><div class="line">      <span class="keyword">or</span> sp.sync_status=<span class="number">2</span> </div><div class="line">      <span class="keyword">or</span> sp.sync_status=<span class="number">4</span></div><div class="line">   );</div></pre></td></tr></table></figure>
<p>0.先看看运行多长时间,951条数据6.22秒，真的很慢</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">951 rows in <span class="keyword">set</span> (<span class="number">6.22</span> sec)</div></pre></td></tr></table></figure>
<p>1.先explain，rows达到了361万，type = ALL表明是全表扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</div><div class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows    | Extra       |</div><div class="line">+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</div><div class="line">|  1 | SIMPLE      | sp    | ALL  | NULL          | NULL | NULL    | NULL | 3613155 | Using where |</div><div class="line">+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+</div></pre></td></tr></table></figure>
<p>2.所有字段都应用查询返回记录数，因为是单表查询 0已经做过了951条<br>3.让explain的rows 尽量逼近951</p>
<p>看一下accurate_result = 1的记录数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">select count(*),accurate_result from stage_poi  group by accurate_result;</div><div class="line">+----------+-----------------+</div><div class="line">| count(*) | accurate_result |</div><div class="line">+----------+-----------------+</div><div class="line">|     1023 |              -1 |</div><div class="line">|  2114655 |               0 |</div><div class="line">|   972815 |               1 |</div><div class="line">+----------+-----------------+</div></pre></td></tr></table></figure>
<p>我们看到accurate_result这个字段的区分度非常低，整个表只有-1,0,1三个值，加上索引也无法锁定特别少量的数据</p>
<p>再看一下sync_status字段的情况</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">select count(*),sync_status from stage_poi  group by sync_status;</div><div class="line">+----------+-------------+</div><div class="line">| count(*) | sync_status |</div><div class="line">+----------+-------------+</div><div class="line">|     3080 |           0 |</div><div class="line">|  3085413 |           3 |</div><div class="line">+----------+-------------+</div></pre></td></tr></table></figure>
<p>同样的区分度也很低，根据理论，也不适合建立索引</p>
<p>问题分析到这，好像得出了这个表无法优化的结论，两个列的区分度都很低，即便加上索引也只能适应这种情况，很难做普遍性的优化，比如当sync_status 0、3分布的很平均，那么锁定记录也是百万级别的</p>
<p>4.找业务方去沟通，看看使用场景。业务方是这么来使用这个SQL语句的，每隔五分钟会扫描符合条件的数据，处理完成后把sync_status这个字段变成1,五分钟符合条件的记录数并不会太多，1000个左右。了解了业务方的使用场景后，优化这个SQL就变得简单了，因为业务方保证了数据的不平衡，如果加上索引可以过滤掉绝大部分不需要的数据</p>
<p>5.根据建立索引规则，使用如下语句建立索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stage_poi <span class="keyword">add</span> <span class="keyword">index</span> idx_acc_status(accurate_result,sync_status);</div></pre></td></tr></table></figure>
<p>6.观察预期结果,发现只需要200ms，快了30多倍。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">952 rows in <span class="keyword">set</span> (<span class="number">0.20</span> sec)</div></pre></td></tr></table></figure>
<p>我们再来回顾一下分析问题的过程，单表查询相对来说比较好优化，大部分时候只需要把where条件里面的字段依照规则加上索引就好，如果只是这种“无脑”优化的话，显然一些区分度非常低的列，不应该加索引的列也会被加上索引，这样会对插入、更新性能造成严重的影响，同时也有可能影响其它的查询语句。所以我们第4步调差SQL的使用场景非常关键，我们只有知道这个业务场景，才能更好地辅助我们更好的分析和优化查询语句。</p>
<h2 id="无法优化的语句"><a href="#无法优化的语句" class="headerlink" title="无法优化的语句"></a>无法优化的语句</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   c.id,</div><div class="line">   c.name,</div><div class="line">   c.position,</div><div class="line">   c.sex,</div><div class="line">   c.phone,</div><div class="line">   c.office_phone,</div><div class="line">   c.feature_info,</div><div class="line">   c.birthday,</div><div class="line">   c.creator_id,</div><div class="line">   c.is_keyperson,</div><div class="line">   c.giveup_reason,</div><div class="line">   c.status,</div><div class="line">   c.data_source,</div><div class="line">   from_unixtime(c.created_time) <span class="keyword">as</span> created_time,</div><div class="line">   from_unixtime(c.last_modified) <span class="keyword">as</span> last_modified,</div><div class="line">   c.last_modified_user_id  </div><div class="line"><span class="keyword">from</span></div><div class="line">   contact c  </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   contact_branch cb </div><div class="line">      <span class="keyword">on</span>  c.id = cb.contact_id  </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   branch_user bu </div><div class="line">      <span class="keyword">on</span>  cb.branch_id = bu.branch_id </div><div class="line">      <span class="keyword">and</span> bu.status <span class="keyword">in</span> (</div><div class="line">         <span class="number">1</span>,</div><div class="line">      <span class="number">2</span>)  </div><div class="line">   <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">      org_emp_info oei </div><div class="line">         <span class="keyword">on</span>  oei.data_id = bu.user_id </div><div class="line">         <span class="keyword">and</span> oei.node_left &gt;= <span class="number">2875</span> </div><div class="line">         <span class="keyword">and</span> oei.node_right &lt;= <span class="number">10802</span> </div><div class="line">         <span class="keyword">and</span> oei.org_category = - <span class="number">1</span>  </div><div class="line">   <span class="keyword">order</span> <span class="keyword">by</span></div><div class="line">      c.created_time <span class="keyword">desc</span>  <span class="keyword">limit</span> <span class="number">0</span> ,</div><div class="line">      <span class="number">10</span>;</div></pre></td></tr></table></figure>
<p>还是几个步骤<br>0.先看语句运行多长时间，10条记录用了13秒，已经不可忍受</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10 rows in <span class="keyword">set</span> (<span class="number">13.06</span> sec)</div></pre></td></tr></table></figure>
<p>1.explain</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+<span class="comment">----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+</span></div><div class="line">| id | select_type | table | type   | possible_keys                       | key                     | key_len | ref                      | rows | Extra                                        |</div><div class="line">+<span class="comment">----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+</span></div><div class="line">|  1 | SIMPLE      | oei   | ref    | idx_category_left_right,idx_data_id | idx_category_left_right | 5       | const                    | 8849 | Using where; Using temporary; Using filesort |</div><div class="line">|  1 | SIMPLE      | bu    | ref    | PRIMARY,idx_userid_status           | idx_userid_status       | 4       | meituancrm.oei.data_id   |   76 | Using where; Using index                     |</div><div class="line">|  1 | SIMPLE      | cb    | ref    | idx_branch_id,idx_contact_branch_id | idx_branch_id           | 4       | meituancrm.bu.branch_id  |    1 |                                              |</div><div class="line">|  1 | SIMPLE      | c     | eq_ref | PRIMARY                             | PRIMARY                 | 108     | meituancrm.cb.contact_id |    1 |                                              |</div><div class="line">+<span class="comment">----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+</span></div></pre></td></tr></table></figure>
<p>从执行计划上看，mysql先查org_emp_info表扫描8849记录，再用索引idx_userid_status关联branch_user表，再用索引idx_branch_id关联contact_branch表，最后主键关联contact表。<br>rows返回的都非常少，看不到有什么异常情况。我们在看一下语句，发现后面有order by + limit组合，会不会是排序量太大搞的？于是我们简化SQL，去掉后面的order by 和 limit，看看到底用了多少记录来排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">  <span class="keyword">count</span>(*)</div><div class="line"><span class="keyword">from</span></div><div class="line">   contact c  </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   contact_branch cb </div><div class="line">      <span class="keyword">on</span>  c.id = cb.contact_id  </div><div class="line"><span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">   branch_user bu </div><div class="line">      <span class="keyword">on</span>  cb.branch_id = bu.branch_id </div><div class="line">      <span class="keyword">and</span> bu.status <span class="keyword">in</span> (</div><div class="line">         <span class="number">1</span>,</div><div class="line">      <span class="number">2</span>)  </div><div class="line">   <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">      org_emp_info oei </div><div class="line">         <span class="keyword">on</span>  oei.data_id = bu.user_id </div><div class="line">         <span class="keyword">and</span> oei.node_left &gt;= <span class="number">2875</span> </div><div class="line">         <span class="keyword">and</span> oei.node_right &lt;= <span class="number">10802</span> </div><div class="line">         <span class="keyword">and</span> oei.org_category = - <span class="number">1</span>  </div><div class="line">+<span class="comment">----------+</span></div><div class="line">| <span class="keyword">count</span>(*) |</div><div class="line">+<span class="comment">----------+</span></div><div class="line">|   <span class="number">778878</span> |</div><div class="line">+<span class="comment">----------+</span></div><div class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">5.19</span> sec)</div></pre></td></tr></table></figure>
<p>发现排序之前居然锁定了778878条记录，如果针对70万的结果集排序，将是灾难性的，怪不得这么慢，那我们能不能换个思路，先根据contact的created_time排序，再来join会不会比较快呢？<br>于是改造成下面的语句，也可以用straight_join来优化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">  c.id,</div><div class="line">  c.name,</div><div class="line">  c.position,</div><div class="line">  c.sex,</div><div class="line">  c.phone,</div><div class="line">  c.office_phone,</div><div class="line">  c.feature_info,</div><div class="line">  c.birthday,</div><div class="line">  c.creator_id,</div><div class="line">  c.is_keyperson,</div><div class="line">  c.giveup_reason,</div><div class="line">  c.status,</div><div class="line">  c.data_source,</div><div class="line">  from_unixtime(c.created_time) <span class="keyword">as</span> created_time,</div><div class="line">  from_unixtime(c.last_modified) <span class="keyword">as</span> last_modified,</div><div class="line">  c.last_modified_user_id</div><div class="line"><span class="keyword">from</span></div><div class="line">  contact c</div><div class="line"><span class="keyword">where</span></div><div class="line">  <span class="keyword">exists</span> (</div><div class="line">    <span class="keyword">select</span></div><div class="line">      <span class="number">1</span></div><div class="line">    <span class="keyword">from</span></div><div class="line">      contact_branch cb</div><div class="line">    <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">      branch_user bu</div><div class="line">        <span class="keyword">on</span> cb.branch_id = bu.branch_id</div><div class="line">        <span class="keyword">and</span> bu.status <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">    <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">      org_emp_info oei</div><div class="line">        <span class="keyword">on</span> oei.data_id = bu.user_id</div><div class="line">        <span class="keyword">and</span> oei.node_left &gt;= <span class="number">2875</span></div><div class="line">        <span class="keyword">and</span> oei.node_right &lt;= <span class="number">10802</span></div><div class="line">        <span class="keyword">and</span> oei.org_category = - <span class="number">1</span></div><div class="line">    <span class="keyword">where</span></div><div class="line">      c.id = cb.contact_id</div><div class="line">  )</div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span></div><div class="line">  c.created_time <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">0</span> ,<span class="number">10</span>;</div></pre></td></tr></table></figure>
<p>验证一下效果 预计在1ms内，提升了13000多倍！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>
<p>本以为至此大工告成，但我们在前面的分析中漏了一个细节，先排序再join和先join再排序理论上开销是一样的，为何提升这么多是因为有一个limit！大致执行过程是：mysql先按索引排序得到前10条记录，然后再去join过滤，当发现不够10条的时候，再次去10条，再次join，这显然在内层join过滤的数据非常多的时候，将是灾难的，极端情况，内层一条数据都找不到，mysql还傻乎乎的每次取10条，几乎遍历了这个数据表！</p>
<p>用不同参数的SQL试验下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line">   sql_no_cache   c.id,</div><div class="line">   c.name,</div><div class="line">   c.position,</div><div class="line">   c.sex,</div><div class="line">   c.phone,</div><div class="line">   c.office_phone,</div><div class="line">   c.feature_info,</div><div class="line">   c.birthday,</div><div class="line">   c.creator_id,</div><div class="line">   c.is_keyperson,</div><div class="line">   c.giveup_reason,</div><div class="line">   c.status,</div><div class="line">   c.data_source,</div><div class="line">   from_unixtime(c.created_time) <span class="keyword">as</span> created_time,</div><div class="line">   from_unixtime(c.last_modified) <span class="keyword">as</span> last_modified,</div><div class="line">   c.last_modified_user_id    </div><div class="line"><span class="keyword">from</span></div><div class="line">   contact c   </div><div class="line"><span class="keyword">where</span></div><div class="line">   <span class="keyword">exists</span> (</div><div class="line">      <span class="keyword">select</span></div><div class="line">         <span class="number">1</span>        </div><div class="line">      <span class="keyword">from</span></div><div class="line">         contact_branch cb         </div><div class="line">      <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">         branch_user bu                     </div><div class="line">            <span class="keyword">on</span>  cb.branch_id = bu.branch_id                     </div><div class="line">            <span class="keyword">and</span> bu.status <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>)                </div><div class="line">         <span class="keyword">inner</span> <span class="keyword">join</span></div><div class="line">            org_emp_info oei                           </div><div class="line">               <span class="keyword">on</span>  oei.data_id = bu.user_id                           </div><div class="line">               <span class="keyword">and</span> oei.node_left &gt;= <span class="number">2875</span>                           </div><div class="line">               <span class="keyword">and</span> oei.node_right &lt;= <span class="number">2875</span>                           </div><div class="line">               <span class="keyword">and</span> oei.org_category = - <span class="number">1</span>                </div><div class="line">         <span class="keyword">where</span></div><div class="line">            c.id = cb.contact_id           </div><div class="line">      )        </div><div class="line">   <span class="keyword">order</span> <span class="keyword">by</span></div><div class="line">      c.created_time <span class="keyword">desc</span>  <span class="keyword">limit</span> <span class="number">0</span> ,</div><div class="line">      <span class="number">10</span>;</div><div class="line">Empty <span class="keyword">set</span> (<span class="number">2</span> <span class="keyword">min</span> <span class="number">18.99</span> sec)</div></pre></td></tr></table></figure>
<p>2 min 18.99 sec！比之前的情况还糟糕很多。由于mysql的nested loop机制，遇到这种情况，基本是无法优化的。这条语句最终也只能交给应用系统去优化自己的逻辑了。<br>通过这个例子我们可以看到，并不是所有语句都能优化，而往往我们优化时，由于SQL用例回归时落掉一些极端情况，会造成比原来还严重的后果。所以，第一：不要指望所有语句都能通过SQL优化，第二：不要过于自信，只针对具体case来优化，而忽略了更复杂的情况。</p>
<p>慢查询的案例就分析到这儿，以上只是一些比较典型的案例。我们在优化过程中遇到过超过1000行，涉及到16个表join的“垃圾SQL”，也遇到过线上线下数据库差异导致应用直接被慢查询拖死，也遇到过varchar等值比较没有写单引号，还遇到过笛卡尔积查询直接把从库搞死。再多的案例其实也只是一些经验的积累，如果我们熟悉查询优化器、索引的内部原理，那么分析这些案例就变得特别简单了。</p>
<h1 id="写在后面的话"><a href="#写在后面的话" class="headerlink" title="写在后面的话"></a>写在后面的话</h1><p>本文以一个慢查询案例引入了MySQL索引原理、优化慢查询的一些方法论;并针对遇到的典型案例做了详细的分析。其实做了这么长时间的语句优化后才发现，任何数据库层面的优化都抵不上应用系统的优化，同样是MySQL，可以用来支撑Google/FaceBook/Taobao应用，但可能连你的个人网站都撑不住。套用最近比较流行的话：“查询容易，优化不易，且写且珍惜！”</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>参考文献如下：<br>1.《高性能MySQL》<br>2.《数据结构与算法分析》</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/24/MySQL-事务隔离级别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/24/MySQL-事务隔离级别/" itemprop="url">MySQL 事务隔离级别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-24T10:52:59+08:00">
                2016-06-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/24/MySQL-事务隔离级别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/24/MySQL-事务隔离级别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/24/MySQL-事务隔离级别/" class="leancloud_visitors" data-flag-title="MySQL 事务隔离级别">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>以下实验基于 MySQL Server version: 5.7.10 Homebrew
</code></pre><h2 id="基础理论"><a href="#基础理论" class="headerlink" title="基础理论"></a>基础理论</h2><p>按照<a href="http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt" target="_blank" rel="external">SQL:1992标准</a> 事务隔离级别分为四个 READ UNCOMMITTED（读未提交）, READ COMMITTED（读已提交）, REPEATABLE READ（可重复读）, 和 SERIALIZABLE 串行化，InnoDB默认是可重复读的（REPEATABLE READ）。可以用 SET TRANSACTION 修改单个 session 的隔离级别，也可以在命令行用–transaction-isolation选项，或在配置文件里，为所有连接设置默认隔离级别。<br>例如，你可以在my.inf文件的[mysqld]节里类似如下设置该选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">transaction-isolation = &#123;READ-UNCOMMITTED | READ-COMMITTED | REPEATABLE-READ | SERIALIZABLE&#125;</div></pre></td></tr></table></figure>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/set-transaction.html" target="_blank" rel="external">SET TRANSACTION</a> 语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SET</span> [<span class="keyword">GLOBAL</span> | <span class="keyword">SESSION</span>] <span class="keyword">TRANSACTION</span></div><div class="line">    transaction_characteristic [, transaction_characteristic] ...</div><div class="line">transaction_characteristic:</div><div class="line">    <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">level</span></div><div class="line">  | <span class="keyword">READ</span> WRITE</div><div class="line">  | <span class="keyword">READ</span> <span class="keyword">ONLY</span></div><div class="line"><span class="keyword">level</span>:</div><div class="line">     REPEATABLE <span class="keyword">READ</span></div><div class="line">   | <span class="keyword">READ</span> COMMITTED</div><div class="line">   | <span class="keyword">READ</span> UNCOMMITTED</div><div class="line">   | <span class="keyword">SERIALIZABLE</span></div></pre></td></tr></table></figure>
<p>Notes:</p>
<ul>
<li>Without any SESSION or GLOBAL keyword, the statement applies to the next (not started) transaction performed within the current session. Subsequent transactions revert to using the SESSION isolation level.</li>
<li>A global change to transaction characteristics requires the SUPER privilege. Any session is free to change its session characteristics (even in the middle of a transaction), or the characteristics for its next transaction.</li>
</ul>
<p>可以通过如下语句查询事务隔离级别：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@global.tx_isolation;</div><div class="line">+-----------------------+</div><div class="line">| @@global.tx_isolation |</div><div class="line">+-----------------------+</div><div class="line">| REPEATABLE-READ       |</div><div class="line">+-----------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line">mysql&gt; select @@tx_isolation;</div><div class="line">+-----------------+</div><div class="line">| @@tx_isolation  |</div><div class="line">+-----------------+</div><div class="line">| REPEATABLE-READ |</div><div class="line">+-----------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<hr>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><table>
<thead>
<tr>
<th style="text-align:left">隔离级别</th>
<th style="text-align:center">脏读（Dirty Read）</th>
<th style="text-align:center">不可重复读（NonRepeatable Read）</th>
<th style="text-align:center">幻读（Phantom Read）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">读未提交（Read uncommitted）</td>
<td style="text-align:center">有</td>
<td style="text-align:center">有</td>
<td style="text-align:center">有</td>
</tr>
<tr>
<td style="text-align:left">读已提交（Read committed）</td>
<td style="text-align:center">无</td>
<td style="text-align:center">有</td>
<td style="text-align:center">有  </td>
</tr>
<tr>
<td style="text-align:left">可重复读（Repeatable read）</td>
<td style="text-align:center">无</td>
<td style="text-align:center">无</td>
<td style="text-align:center">有  </td>
</tr>
<tr>
<td style="text-align:left">串行化（Serializable）</td>
<td style="text-align:center">无</td>
<td style="text-align:center">无</td>
<td style="text-align:center">无   </td>
</tr>
</tbody>
</table>
<ul>
<li>读未提交（Read uncommitted）允许脏读，也就是可能读取到其他会话中未提交事务修改的数据</li>
<li>读已提交（Read Committed）只能读取到已经提交的数据。Oracle等多数数据库默认都是该级别（不可重复读）</li>
<li>可重复读（Repeatable read）可重复读。在同一个事务内的查询都是事务开始时刻一致的，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻象读</li>
<li>串行化（Serializable）完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞</li>
</ul>
<h2 id="初始化实验环境"><a href="#初始化实验环境" class="headerlink" title="初始化实验环境"></a>初始化实验环境</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">test</span>;</div><div class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tx_test`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</div><div class="line">  <span class="string">`value`</span> <span class="built_in">VARCHAR</span>(<span class="number">16</span>)  <span class="literal">NULL</span>  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></div><div class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</div></pre></td></tr></table></figure>
<h2 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h2><p><em>脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。</em></p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@global.tx_isolation;</div><div class="line">+-----------------------+</div><div class="line">| @@global.tx_isolation |</div><div class="line">+-----------------------+</div><div class="line">| REPEATABLE-READ       |</div><div class="line">+-----------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values(1, null);</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-------+</div><div class="line">| id | value |</div><div class="line">+----+-------+</div><div class="line">|  1 | NULL  |</div><div class="line">+----+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@global.tx_isolation;</div><div class="line">+-----------------------+</div><div class="line">| @@global.tx_isolation |</div><div class="line">+-----------------------+</div><div class="line">| REPEATABLE-READ       |</div><div class="line">+-----------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; use test;</div><div class="line">Reading table information for completion of table and column names</div><div class="line">You can turn off this feature to get a quicker startup with -A</div><div class="line"></div><div class="line">Database changed</div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">Empty set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; set session transaction isolation level read uncommitted;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| READ-UNCOMMITTED       |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-------+</div><div class="line">| id | value |</div><div class="line">+----+-------+</div><div class="line">|  1 | NULL  |</div><div class="line">+----+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>由此可见，session 2 在 READ-UNCOMMITTED 下读取到了 session 1 中修改未提交事务的数据。</p>
<h2 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h2><p><em>是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。</em></p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; set session transaction isolation level read committed;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| READ-COMMITTED         |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-------+</div><div class="line">| id | value |</div><div class="line">+----+-------+</div><div class="line">|  1 | NULL  |</div><div class="line">+----+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">mysql&gt; set session transaction isolation level repeatable read;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-------+</div><div class="line">| id | value |</div><div class="line">+----+-------+</div><div class="line">|  1 | NULL  |</div><div class="line">+----+-------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; update tx_test set value = 'new value' where id = 1;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">+----+-----------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">+----+-----------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>可见 session 1 在 session 2 事务提交前后查询结果不一样，在 READ-COMMITTED 级别出现了不可重复读。</p>
<h2 id="可重复读"><a href="#可重复读" class="headerlink" title="可重复读"></a>可重复读</h2><p>**</p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">mysql&gt; set session transaction isolation level repeatable read;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">+----+-----------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@session.tx_isolation;</div><div class="line">+------------------------+</div><div class="line">| @@session.tx_isolation |</div><div class="line">+------------------------+</div><div class="line">| REPEATABLE-READ        |</div><div class="line">+------------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values (2, null);</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">+----+-----------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">+----+-----------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">+----+-----------+</div><div class="line">2 rows in set (0.01 sec)</div></pre></td></tr></table></figure>
<p>可用看到在 REPEATABLE-READ 级别同一个事务里出现了重复读。</p>
<h2 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h2><p><em>第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部所有行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，提交事务以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。</em></p>
<p>保持两个 session 都是 REPEATABLE-READ 级别</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@global.tx_isolation, @@session.tx_isolation, @@tx_isolation;</div><div class="line">+-----------------------+------------------------+-----------------+</div><div class="line">| @@global.tx_isolation | @@session.tx_isolation | @@tx_isolation  |</div><div class="line">+-----------------------+------------------------+-----------------+</div><div class="line">| REPEATABLE-READ       | REPEATABLE-READ        | REPEATABLE-READ |</div><div class="line">+-----------------------+------------------------+-----------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>实验一，插入数据：</p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">+----+-----------+</div><div class="line">2 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values (3, 'here');</div><div class="line">Query OK, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">+----+-----------+</div><div class="line">2 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">+----+-----------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values (3, 'Why');</div><div class="line">ERROR 1062 (23000): Duplicate entry '3' for key 'PRIMARY'</div></pre></td></tr></table></figure>
<p>session 1 就是出现了幻读，以为数据库里没有 id 是3的记录，实际上数据是存在的。</p>
<p>实验二，同时改变数据：</p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">|  3 | here      |</div><div class="line">+----+-----------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; insert into tx_test values (4, 'new line');</div><div class="line">Query OK, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">|  3 | here      |</div><div class="line">+----+-----------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+-----------+</div><div class="line">| id | value     |</div><div class="line">+----+-----------+</div><div class="line">|  1 | new value |</div><div class="line">|  2 | NULL      |</div><div class="line">|  3 | here      |</div><div class="line">+----+-----------+</div><div class="line">3 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; update tx_test set value = 'new value in all';</div><div class="line">Query OK, 4 rows affected (0.00 sec)</div><div class="line">Rows matched: 4  Changed: 4  Warnings: 0</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">+----+------------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>这里 session 1 发生了什么？ 查询时是3条记录，update 后就变成4条了。<br><em>当隔离级别是可重复读，且禁用 innodb_locks_unsafe_for_binlog 的情况下，在搜索和扫描 index 的时候使用的 next-key locks 可以避免幻读。</em></p>
<p>实验三，主键加锁：</p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test where id &lt;= 2 for update;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">+----+------------------+</div><div class="line">2 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values (5, '5st line');</div><div class="line">Query OK, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">+----+------------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; update tx_test set value = '1st line' where id = 1;</div><div class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</div></pre></td></tr></table></figure>
<p>此时 session 2 会等待到超时，然后抛出错误信息。因为用 id &lt;= 2 锁定了主键范围，所以可以增加 id 为5的记录，但修改 id 为2的记录时就必须等待锁释放。</p>
<p>实验四， 一致性读和提交读：</p>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">|  5 | 5st line         |</div><div class="line">+----+------------------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 2:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into tx_test values (6, '6st');</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>session 1:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">|  5 | 5st line         |</div><div class="line">+----+------------------+</div><div class="line">5 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test lock in share mode;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">|  5 | 5st line         |</div><div class="line">|  6 | 6st              |</div><div class="line">+----+------------------+</div><div class="line">6 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test for update;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">|  5 | 5st line         |</div><div class="line">|  6 | 6st              |</div><div class="line">+----+------------------+</div><div class="line">6 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from tx_test;</div><div class="line">+----+------------------+</div><div class="line">| id | value            |</div><div class="line">+----+------------------+</div><div class="line">|  1 | new value in all |</div><div class="line">|  2 | new value in all |</div><div class="line">|  3 | new value in all |</div><div class="line">|  4 | new value in all |</div><div class="line">|  5 | 5st line         |</div><div class="line">+----+------------------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>在 session 1 里，使用普通读查询，会得到可重复读的一致性结果，如果使用了加锁的读，就会读到其他 session 最新提交到结果。</p>
<p>读已提交和可重复读是个矛盾体，不可同时满足，但是可以在可重复读里通过加锁查询来读已提交， 这个加锁机制就是 <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html" target="_blank" rel="external">Locking Reads</a>，默认可重复读并不保证避免幻读。</p>
<p>参考：</p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html" target="_blank" rel="external">MySQL 5.7 Reference Manual</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/23/MySQL-备份和恢复/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/23/MySQL-备份和恢复/" itemprop="url">MySQL 备份和恢复</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-23T16:55:07+08:00">
                2016-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/23/MySQL-备份和恢复/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/23/MySQL-备份和恢复/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/23/MySQL-备份和恢复/" class="leancloud_visitors" data-flag-title="MySQL 备份和恢复">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用 mysqldump 命令备份</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mysqldump --opt -u [uname] -p[pass] [dbname] &gt; [backupfile.sql]</div></pre></td></tr></table></figure>
<ul>
<li>[uname] 数据库用户名</li>
<li>[pass] 密码 (-p和密码之间无空格，不建议使用)</li>
<li>[dbname] 数据库名称</li>
<li>[backupfile.sql] 生产备份文件的名称</li>
<li>[–opt] mysqldump 选项</li>
</ul>
<p>例如：备份名叫 Tutorials 的数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mysqldump -u root -p Tutorials &gt; tut_backup.sql</div></pre></td></tr></table></figure>
<p>如果只需要备份数据库 Tutorials 中指定的表 php_tutorials 和 asp_tutorials，可以使用如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mysqldump -u root -p Tutorials php_tutorials asp_tutorials &gt; tut_backup.sql</div></pre></td></tr></table></figure>
<p>有时候需要一次备份多个数据库，可以使用 –databases 选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mysqldump -u root -p --databases Tutorials Articles Comments &gt; content_backup.sql</div></pre></td></tr></table></figure>
<p>如果需要一次备份所有数据库，可以使用 –all-databases 选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mysqldump -u root -p --all-databases &gt; alldb_backup.sql</div></pre></td></tr></table></figure>
<p>mysqldump 还有一些选项可用:</p>
<ul>
<li>–add-drop-table: 在 CREATE TABLE 前加入 DROP TABLE 语句。</li>
<li>–no-data: 仅备份数据库结构，不含数据。</li>
<li>–add-locks: 增加 LOCK TABLES and UNLOCK TABLES 语句在备份文件中。</li>
</ul>
<p>备份文件是比较大的，可用配合文件压缩使用导出压缩过的备份文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ mysqldump -u [uname] -p[pass] [dbname] | gzip -9 &gt; [backupfile.sql.gz]</div><div class="line"><span class="comment"># 解压可用使用如下命令</span></div><div class="line"><span class="comment"># gunzip [backupfile.sql.gz]</span></div><div class="line"><span class="comment"># 通常直接用管道命令恢复数据库即可</span></div><div class="line">$ gunzip &lt; [backupfile.sql.gz] | mysql -u [uname] -p[pass] [dbname]</div></pre></td></tr></table></figure>
<p>如果要恢复的数据库已经存在，可用使用 mysqlimport 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqlimport -u [uname] -p[pass] [dbname] [backupfile.sql]</div></pre></td></tr></table></figure>
<p>另外还有导出导入CSV文件的方式，此种方式可以用来将 MySQL的数据使用 mongoimport 导入到 MongoDB。</p>
<p>通过mysql客户端shell连接到服务器，选择使用的数据库，输入sql代码： </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> php_tutorials   </div><div class="line"><span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'/tmp/tutorials.csv'</span>   </div><div class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> <span class="keyword">optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span> <span class="keyword">escaped</span> <span class="keyword">by</span> <span class="string">'"'</span>   </div><div class="line"><span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\r\n'</span>;</div></pre></td></tr></table></figure>
<p>格式参数是根据RFC4180文档设置的，该文档全称Common Format and MIME Type for Comma-Separated Values (CSV) Files，其中详细描述了CSV格式，其要点是：</p>
<ol>
<li>字段之间以逗号分隔，数据行之间以\r\n分隔；</li>
<li>字符串以半角双引号包围，字符串本身的双引号用两个双引号表示。</li>
</ol>
<p>通过执行上述代码，便可以将需要的数据以csv格式导出到执行的文件中。</p>
<p>MySQL中导入CSV格式数据的sql代码如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'/tmp/tutorials.csv'</span>  </div><div class="line"><span class="keyword">into</span> <span class="keyword">table</span> php_tutorials   </div><div class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>  <span class="keyword">optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span> <span class="keyword">escaped</span> <span class="keyword">by</span> <span class="string">'"'</span>  </div><div class="line"><span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\r\n'</span>;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/22/Mac-键盘快捷键/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/Mac-键盘快捷键/" itemprop="url">Mac 键盘快捷键</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-22T21:48:32+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/Mac-键盘快捷键/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/22/Mac-键盘快捷键/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/22/Mac-键盘快捷键/" class="leancloud_visitors" data-flag-title="Mac 键盘快捷键">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>您可以按组合键来执行通常需要鼠标、触控板或其他输入设备才能完成的操作。<br>要使用键盘快捷键，请按住一个或多个修饰键，同时按快捷键的最后一个键。例如，要使用快捷键 Command-C（拷贝），请按住 Command 键并按 C 键，然后同时松开这两个键。Mac 菜单和键盘通常使用符号来代表某些按键，其中包括以下修饰键：</p>
<ul>
<li>Command ⌘</li>
<li>Shift ⇧</li>
<li>Option ⌥</li>
<li>Control ⌃</li>
<li>Caps Lock ⇪</li>
<li>Fn</li>
</ul>
<p>如果您使用的是 Windows PC 专用键盘，请用 Alt 键代替 Option 键，用 Windows 标志键代替 Command 键。有些 Mac 键盘在顶行中设有特殊按键，快捷键中也会用到它们；这些按键上有音量图标、显示屏亮度图标和其他功能图标。按下图标键可执行相应功能，将其与 Fn 键组合可用作 F1、F2、F3 或其他标准功能键。 </p>
<p>要了解更多快捷键，请查看您所用应用的菜单。每个应用都有其自己的快捷键，并且一个应用中使用的快捷键可能不适用于另一个应用。</p>
<hr>
<h2 id="剪切、拷贝、粘贴和其他常用快捷键"><a href="#剪切、拷贝、粘贴和其他常用快捷键" class="headerlink" title="剪切、拷贝、粘贴和其他常用快捷键"></a>剪切、拷贝、粘贴和其他常用快捷键</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Command-X</td>
<td style="text-align:left">剪切：删除所选项并将其拷贝到剪贴板。</td>
</tr>
<tr>
<td style="text-align:left">Command-C</td>
<td style="text-align:left">将所选项拷贝到剪贴板。这同样适用于 Finder 中的文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-V</td>
<td style="text-align:left">将剪贴板的内容粘贴到当前文稿或应用中。这同样适用于 Finder 中的文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-Z</td>
<td style="text-align:left">撤销前一个命令。随后您可以按 Command-Shift-Z 来重做，从而反向执行撤销命令。在某些应用中，您可以撤销和重做多个命令。</td>
</tr>
<tr>
<td style="text-align:left">Command-A</td>
<td style="text-align:left">全选各项。</td>
</tr>
<tr>
<td style="text-align:left">Command-F</td>
<td style="text-align:left">查找：打开“查找”窗口，或在文稿中查找项目。</td>
</tr>
<tr>
<td style="text-align:left">Command-G</td>
<td style="text-align:left">再次查找：查找之前所找到项目出现的下一个位置。要查找其出现的上一个位置，请按 Command-Shift-G。</td>
</tr>
<tr>
<td style="text-align:left">Command-H</td>
<td style="text-align:left">隐藏最前端应用的窗口。要查看最前端的应用但隐藏所有其他应用，请按 Command-Option-H。</td>
</tr>
<tr>
<td style="text-align:left">Command-M</td>
<td style="text-align:left">将最前端的窗口最小化至 Dock。要最小化最前端应用的所有窗口，请按 Command-Option-M。</td>
</tr>
<tr>
<td style="text-align:left">Command-N</td>
<td style="text-align:left">新建：打开一个新文稿或窗口。</td>
</tr>
<tr>
<td style="text-align:left">Command-O</td>
<td style="text-align:left">打开所选项，或打开一个对话框以选择要打开的文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-P</td>
<td style="text-align:left">打印当前文稿。</td>
</tr>
<tr>
<td style="text-align:left">Command-S</td>
<td style="text-align:left">存储当前文稿。</td>
</tr>
<tr>
<td style="text-align:left">Command-W</td>
<td style="text-align:left">关闭最前端的窗口。要关闭该应用的所有窗口，请按 Command-Option-W。</td>
</tr>
<tr>
<td style="text-align:left">Command-Q</td>
<td style="text-align:left">退出应用。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-Esc</td>
<td style="text-align:left">强制退出：选择要强制退出的应用。或者，按住 Command-Shift-Option-Esc 3 秒钟可仅强制最前端的应用退出。</td>
</tr>
<tr>
<td style="text-align:left">Command–空格键</td>
<td style="text-align:left">Spotlight：显示或隐藏 Spotlight 搜索栏。要从 Finder 窗口执行 Spotlight 搜索，请按 Command–Option–空格键。如果您使用多个输入源以便用不同的语言键入内容，这些快捷键会更改输入源而非显示 Spotlight。</td>
</tr>
<tr>
<td style="text-align:left">空格键</td>
<td style="text-align:left">快速查看：使用快速查看预览所选项。</td>
</tr>
<tr>
<td style="text-align:left">Command-Tab</td>
<td style="text-align:left">切换应用：在打开的应用中切换到下一个最近使用的应用。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-波浪号 (~)</td>
<td style="text-align:left">切换窗口：切换到最前端应用中下一个最近使用的窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-3</td>
<td style="text-align:left">屏幕快照：拍摄整个屏幕的屏幕快照。了解更多屏幕快照快捷键。</td>
</tr>
<tr>
<td style="text-align:left">Command-逗号 (,)</td>
<td style="text-align:left">偏好设置：打开最前端应用的偏好设置。</td>
</tr>
</tbody>
</table>
<h2 id="睡眠、注销和关机快捷键"><a href="#睡眠、注销和关机快捷键" class="headerlink" title="睡眠、注销和关机快捷键"></a>睡眠、注销和关机快捷键</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">电源按钮</td>
<td style="text-align:left">轻按可打开 Mac 或将 Mac 从睡眠状态唤醒。当 Mac 处于唤醒状态时，按住此按钮 1.5 秒钟会显示一个对话框，询问您是要重新启动、睡眠还是关机。如果您不想等待 1.5 秒钟，请按下 Control–电源按钮或 Control–介质推出键。按住此按钮 5秒钟会强制 Mac 关机。</td>
</tr>
<tr>
<td style="text-align:left">Control–Command–电源按钮</td>
<td style="text-align:left">强制 Mac 重新启动。</td>
</tr>
<tr>
<td style="text-align:left">Control–Shift–（电源按钮或介质推出键）</td>
<td style="text-align:left">将显示器置于睡眠状态。</td>
</tr>
<tr>
<td style="text-align:left">Control–Command–介质推出键</td>
<td style="text-align:left">退出所有应用，然后重新启动 Mac。如果任何打开的文稿有未存储的更改，系统将询问您是否要存储这些更改。</td>
</tr>
<tr>
<td style="text-align:left">Control–Option–Command–（电源按钮或介质推出键）</td>
<td style="text-align:left">退出所有应用，然后关闭 Mac。如果任何打开的文稿有未存储的更改，系统将询问您是否要存储这些更改。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-Q</td>
<td style="text-align:left">注销您的 OS X 用户帐户。系统将提示您确认。</td>
</tr>
<tr>
<td style="text-align:left">Option-Shift-Command-Q</td>
<td style="text-align:left">立即注销您的 OS X 用户帐户，且系统不提示您确认。</td>
</tr>
</tbody>
</table>
<h2 id="文稿快捷键"><a href="#文稿快捷键" class="headerlink" title="文稿快捷键"></a>文稿快捷键</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Command-B</td>
<td style="text-align:left">以粗体显示所选文本，或者打开或关闭粗体显示功能。 </td>
</tr>
<tr>
<td style="text-align:left">Command-I</td>
<td style="text-align:left">以斜体显示所选文本，或者打开或关闭斜体显示功能。</td>
</tr>
<tr>
<td style="text-align:left">Command-U</td>
<td style="text-align:left">对所选文本加下划线，或者打开或关闭加下划线功能。</td>
</tr>
<tr>
<td style="text-align:left">Command-T</td>
<td style="text-align:left">显示或隐藏“字体”窗口.</td>
</tr>
<tr>
<td style="text-align:left">Command-D</td>
<td style="text-align:left">从“打开”对话框或“存储”对话框中选择“桌面”文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Control-Command-D</td>
<td style="text-align:left">显示或隐藏所选字词的定义。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-冒号 (:)</td>
<td style="text-align:left">显示“拼写和语法”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Command-分号 (;)</td>
<td style="text-align:left">查找文稿中拼写错误的字词。</td>
</tr>
<tr>
<td style="text-align:left">Option-Delete</td>
<td style="text-align:left">删除插入点左边的字词。</td>
</tr>
<tr>
<td style="text-align:left">Control-H</td>
<td style="text-align:left">删除插入点左边的字符。也可以使用 Delete 键。</td>
</tr>
<tr>
<td style="text-align:left">Control-D</td>
<td style="text-align:left">删除插入点右边的字符。也可以使用 Fn-Delete。</td>
</tr>
<tr>
<td style="text-align:left">Fn-Delete</td>
<td style="text-align:left">在没有向前删除键   的键盘上向前删除。也可以使用 Control-D。</td>
</tr>
<tr>
<td style="text-align:left">Control-K</td>
<td style="text-align:left">删除插入点与行或段落末尾处之间的文本。</td>
</tr>
<tr>
<td style="text-align:left">Command-Delete</td>
<td style="text-align:left">在包含“删除”或“不存储”按钮的对话框中选择“删除”或“不存储”。</td>
</tr>
<tr>
<td style="text-align:left">Fn–上箭头</td>
<td style="text-align:left">向上翻页：向上滚动一页。 </td>
</tr>
<tr>
<td style="text-align:left">Fn–下箭头</td>
<td style="text-align:left">向下翻页：向下滚动一页。</td>
</tr>
<tr>
<td style="text-align:left">Fn–左箭头</td>
<td style="text-align:left">开头：滚动到文稿开头。</td>
</tr>
<tr>
<td style="text-align:left">Fn–右箭头</td>
<td style="text-align:left">结尾：滚动到文稿末尾。</td>
</tr>
<tr>
<td style="text-align:left">Command–上箭头</td>
<td style="text-align:left">将插入点移至文稿开头。</td>
</tr>
<tr>
<td style="text-align:left">Command–下箭头</td>
<td style="text-align:left">将插入点移至文稿末尾。</td>
</tr>
<tr>
<td style="text-align:left">Command–左箭头</td>
<td style="text-align:left">将插入点移至当前行的行首。</td>
</tr>
<tr>
<td style="text-align:left">Command–右箭头</td>
<td style="text-align:left">将插入点移至当前行的行尾。</td>
</tr>
<tr>
<td style="text-align:left">Option–左箭头</td>
<td style="text-align:left">将插入点移至上一字词的词首。</td>
</tr>
<tr>
<td style="text-align:left">Option–右箭头</td>
<td style="text-align:left">将插入点移至下一字词的词尾。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–上箭头</td>
<td style="text-align:left">选中插入点与文稿开头之间的文本。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–下箭头</td>
<td style="text-align:left">选中插入点与文稿末尾之间的文本。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–左箭头</td>
<td style="text-align:left">选中插入点与当前行行首之间的文本。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–右箭头</td>
<td style="text-align:left">选中插入点与当前行行尾之间的文本。</td>
</tr>
<tr>
<td style="text-align:left">Shift–上箭头</td>
<td style="text-align:left">将文本选择范围扩展到上一行相同水平位置的最近字符处。</td>
</tr>
<tr>
<td style="text-align:left">Shift–下箭头</td>
<td style="text-align:left">将文本选择范围扩展到下一行相同水平位置的最近字符处。</td>
</tr>
<tr>
<td style="text-align:left">Shift–左箭头</td>
<td style="text-align:left">将文本选择范围向左扩展一个字符。</td>
</tr>
<tr>
<td style="text-align:left">Shift–右箭头</td>
<td style="text-align:left">将文本选择范围向右扩展一个字符。</td>
</tr>
<tr>
<td style="text-align:left">Option–Shift–上箭头</td>
<td style="text-align:left">将文本选择范围扩展到当前段落的段首，再按一次则扩展到下一段落的段首。</td>
</tr>
<tr>
<td style="text-align:left">Option–Shift–下箭头</td>
<td style="text-align:left">将文本选择范围扩展到当前段落的段尾，再按一次则扩展到下一段落的段尾。</td>
</tr>
<tr>
<td style="text-align:left">Option–Shift–左箭头</td>
<td style="text-align:left">将文本选择范围扩展到当前字词的词首，再按一次则扩展到后一字词的词首。</td>
</tr>
<tr>
<td style="text-align:left">Option–Shift–右箭头</td>
<td style="text-align:left">将文本选择范围扩展到当前字词的词尾，再按一次则扩展到后一字词的词尾。</td>
</tr>
<tr>
<td style="text-align:left">Control-A</td>
<td style="text-align:left">移至行或段落的开头。</td>
</tr>
<tr>
<td style="text-align:left">Control-E</td>
<td style="text-align:left">移至行或段落的末尾。</td>
</tr>
<tr>
<td style="text-align:left">Control-F</td>
<td style="text-align:left">向前移动一个字符。</td>
</tr>
<tr>
<td style="text-align:left">Control-B</td>
<td style="text-align:left">向后移动一个字符。</td>
</tr>
<tr>
<td style="text-align:left">Control-L</td>
<td style="text-align:left">将光标或所选内容置于可见区域中央。</td>
</tr>
<tr>
<td style="text-align:left">Control-P</td>
<td style="text-align:left">上移一行。</td>
</tr>
<tr>
<td style="text-align:left">Control-N</td>
<td style="text-align:left">下移一行。</td>
</tr>
<tr>
<td style="text-align:left">Control-O</td>
<td style="text-align:left">在插入点后插入一行。</td>
</tr>
<tr>
<td style="text-align:left">Control-T</td>
<td style="text-align:left">将插入点后面的字符与插入点前面的字符交换。</td>
</tr>
<tr>
<td style="text-align:left">Command–左花括号 ({)</td>
<td style="text-align:left">左对齐。</td>
</tr>
<tr>
<td style="text-align:left">Command–右花括号 (})</td>
<td style="text-align:left">右对齐。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–竖线</td>
<td style="text-align:left">居中对齐。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-F</td>
<td style="text-align:left">前往搜索栏。 </td>
</tr>
<tr>
<td style="text-align:left">Option-Command-T</td>
<td style="text-align:left">显示或隐藏应用中的工具栏。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-C</td>
<td style="text-align:left">拷贝样式：将所选项的格式设置拷贝到剪贴板。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-V</td>
<td style="text-align:left">粘贴样式：将拷贝的样式应用到所选项。</td>
</tr>
<tr>
<td style="text-align:left">Option-Shift-Command-V</td>
<td style="text-align:left">粘贴并匹配样式：将周围内容的样式应用到粘贴在该内容中的项目。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-I</td>
<td style="text-align:left">显示或隐藏检查器窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-P</td>
<td style="text-align:left">页面设置：显示用于选择文稿设置的窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-S</td>
<td style="text-align:left">显示“存储为”对话框或复制当前文稿。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–减号 (-)</td>
<td style="text-align:left">缩小所选项。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–加号 (+)</td>
<td style="text-align:left">放大所选项。Command–等号 (=) 可执行相同的功能。</td>
</tr>
<tr>
<td style="text-align:left">Shift–Command–问号 (?)</td>
<td style="text-align:left">打开“帮助”菜单。</td>
</tr>
</tbody>
</table>
<h2 id="Finder-快捷键"><a href="#Finder-快捷键" class="headerlink" title="Finder 快捷键"></a>Finder 快捷键</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Command-D</td>
<td style="text-align:left">复制所选文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-E</td>
<td style="text-align:left">推出所选磁盘或宗卷。</td>
</tr>
<tr>
<td style="text-align:left">Command-F</td>
<td style="text-align:left">在 Finder 窗口中开始 Spotlight 搜索。</td>
</tr>
<tr>
<td style="text-align:left">Command-I</td>
<td style="text-align:left">显示所选文件的“显示简介”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-C</td>
<td style="text-align:left">打开“电脑”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-D</td>
<td style="text-align:left">打开“桌面”文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-F</td>
<td style="text-align:left">打开“我的所有文件”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-G</td>
<td style="text-align:left">打开“前往文件夹”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-H</td>
<td style="text-align:left">打开当前 OS X 用户帐户的个人文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-I</td>
<td style="text-align:left">打开 iCloud Drive。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-K</td>
<td style="text-align:left">打开“网络”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-L</td>
<td style="text-align:left">打开“下载”文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-O</td>
<td style="text-align:left">打开“文稿”文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-R</td>
<td style="text-align:left">打开“AirDrop”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-T</td>
<td style="text-align:left">将所选的 Finder 项目添加到 Dock（OS X Mountain Lion 或较早版本）</td>
</tr>
<tr>
<td style="text-align:left">Control-Shift-Command-T</td>
<td style="text-align:left">将所选的 Finder 项目添加到 Dock（OS X Mavericks 或更高版本）</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-U</td>
<td style="text-align:left">打开“实用工具”文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-D</td>
<td style="text-align:left">显示或隐藏 Dock。即使您未打开 Finder，此快捷键通常也有效。</td>
</tr>
<tr>
<td style="text-align:left">Control-Command-T</td>
<td style="text-align:left">将所选项添加到边栏（OS X Mavericks 或更高版本）。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-P</td>
<td style="text-align:left">隐藏或显示 Finder 窗口中的路径栏。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-S</td>
<td style="text-align:left">隐藏或显示 Finder 窗口中的边栏。</td>
</tr>
<tr>
<td style="text-align:left">Command–斜线 (/)</td>
<td style="text-align:left">隐藏或显示 Finder 窗口中的状态栏。</td>
</tr>
<tr>
<td style="text-align:left">Command-J</td>
<td style="text-align:left">调出“显示”选项。</td>
</tr>
<tr>
<td style="text-align:left">Command-K</td>
<td style="text-align:left">打开“连接服务器”窗口。</td>
</tr>
<tr>
<td style="text-align:left">Command-L</td>
<td style="text-align:left">为所选项制作替身。</td>
</tr>
<tr>
<td style="text-align:left">Command-N</td>
<td style="text-align:left">打开一个新的 Finder 窗口。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-N</td>
<td style="text-align:left">新建文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-N</td>
<td style="text-align:left">新建智能文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command-R</td>
<td style="text-align:left">显示所选替身的原始文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-T</td>
<td style="text-align:left">在当前 Finder 窗口中打开单个标签时显示或隐藏标签栏。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-T</td>
<td style="text-align:left">显示或隐藏 Finder 标签。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-T</td>
<td style="text-align:left">在当前 Finder 窗口中打开单个标签时显示或隐藏工具栏。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-V</td>
<td style="text-align:left">移动：将剪贴板中的文件从其原始位置移动到当前位置。</td>
</tr>
<tr>
<td style="text-align:left">Option-Command-Y</td>
<td style="text-align:left">查看所选文件的快速查看幻灯片显示。</td>
</tr>
<tr>
<td style="text-align:left">Command-Y</td>
<td style="text-align:left">使用“快速查看”预览所选文件。</td>
</tr>
<tr>
<td style="text-align:left">Command-1</td>
<td style="text-align:left">以图标方式显示 Finder 窗口中的项目。</td>
</tr>
<tr>
<td style="text-align:left">Command-2</td>
<td style="text-align:left">以列表方式显示 Finder 窗口中的项目。</td>
</tr>
<tr>
<td style="text-align:left">Command-3</td>
<td style="text-align:left">以分栏方式显示 Finder 窗口中的项目。 </td>
</tr>
<tr>
<td style="text-align:left">Command-4</td>
<td style="text-align:left">以 Cover Flow 方式显示 Finder 窗口中的项目。</td>
</tr>
<tr>
<td style="text-align:left">Command–左中括号 ([)</td>
<td style="text-align:left">前往上一文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command–右中括号 (])</td>
<td style="text-align:left">前往下一文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command–上箭头</td>
<td style="text-align:left">打开包含当前文件夹的文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command–Control–上箭头</td>
<td style="text-align:left">在新窗口中打开包含当前文件夹的文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command–下箭头</td>
<td style="text-align:left">打开所选项。</td>
</tr>
<tr>
<td style="text-align:left">Command–Mission Control</td>
<td style="text-align:left">显示桌面。即使您未打开 Finder，此快捷键也有效。</td>
</tr>
<tr>
<td style="text-align:left">Command–调高亮度</td>
<td style="text-align:left">开启或关闭目标显示器模式。</td>
</tr>
<tr>
<td style="text-align:left">Command–调低亮度</td>
<td style="text-align:left">当 Mac 连接到多个显示器时打开或关闭显示器镜像功能。</td>
</tr>
<tr>
<td style="text-align:left">右箭头</td>
<td style="text-align:left">打开所选文件夹。此快捷键仅在列表视图中有效。</td>
</tr>
<tr>
<td style="text-align:left">左箭头</td>
<td style="text-align:left">关闭所选文件夹。此快捷键仅在列表视图中有效。</td>
</tr>
<tr>
<td style="text-align:left">Option-连按</td>
<td style="text-align:left">在单独窗口中打开文件夹，并关闭当前窗口。</td>
</tr>
<tr>
<td style="text-align:left">Command-连按</td>
<td style="text-align:left">在单独标签或窗口中打开文件夹。</td>
</tr>
<tr>
<td style="text-align:left">Command-Delete</td>
<td style="text-align:left">将所选项移到废纸篓。</td>
</tr>
<tr>
<td style="text-align:left">Shift-Command-Delete</td>
<td style="text-align:left">清倒废纸篓。</td>
</tr>
<tr>
<td style="text-align:left">Option-Shift-Command-Delete</td>
<td style="text-align:left">清倒废纸篓（不显示确认对话框）。</td>
</tr>
<tr>
<td style="text-align:left">Command-Y</td>
<td style="text-align:left">使用“快速查看”预览文件。</td>
</tr>
<tr>
<td style="text-align:left">Option–调高亮度</td>
<td style="text-align:left">打开“显示器”偏好设置。此快捷键可与任一亮度键搭配使用。</td>
</tr>
<tr>
<td style="text-align:left">Option–Mission Control</td>
<td style="text-align:left">打开“Mission Control”偏好设置。</td>
</tr>
<tr>
<td style="text-align:left">Option–调高音量</td>
<td style="text-align:left">打开“声音”偏好设置。此快捷键可与任一音量键搭配使用。</td>
</tr>
<tr>
<td style="text-align:left">拖移时按 Command 键</td>
<td style="text-align:left">将拖移的项目移到其他宗卷或位置。拖移项目时指针会随之变化。</td>
</tr>
<tr>
<td style="text-align:left">拖移时按 Option 键</td>
<td style="text-align:left">拷贝拖移的项目。拖移项目时指针会随之变化。</td>
</tr>
<tr>
<td style="text-align:left">拖移时按 Option-Command</td>
<td style="text-align:left">为拖移的项目制作替身。拖移项目时指针会随之变化。</td>
</tr>
<tr>
<td style="text-align:left">Option-点按开合三角</td>
<td style="text-align:left">打开所选文件夹内的所有文件夹。此快捷键仅在列表视图中有效。</td>
</tr>
<tr>
<td style="text-align:left">Command-点按窗口标题</td>
<td style="text-align:left">查看包含当前文件夹的文件夹。</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/22/IntelliJ-IDEA-Mac-OS-X-Keymap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/IntelliJ-IDEA-Mac-OS-X-Keymap/" itemprop="url">IntelliJ IDEA Mac OS X Keymap</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-22T19:44:04+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/IntelliJ-IDEA/" itemprop="url" rel="index">
                    <span itemprop="name">IntelliJ IDEA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/IntelliJ-IDEA-Mac-OS-X-Keymap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/22/IntelliJ-IDEA-Mac-OS-X-Keymap/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/22/IntelliJ-IDEA-Mac-OS-X-Keymap/" class="leancloud_visitors" data-flag-title="IntelliJ IDEA Mac OS X Keymap">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌃Space</td>
<td>Basic code completion (the name of any class, method or variable) 基本代码完成(任何类，方法的名称或变量)</td>
</tr>
<tr>
<td style="text-align:left">⌃⇧Space</td>
<td>Smart code completion (filters the list of methods and variables by expected type) 智能代码完成(过滤预期类型的方法和变量列表)</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧↵</td>
<td>Complete statement 完成语句</td>
</tr>
<tr>
<td style="text-align:left">⌘P</td>
<td>Parameter info (within method call arguments) 参数信息(在方法调用的参数)</td>
</tr>
<tr>
<td style="text-align:left">⌃J, Mid.button click</td>
<td>Quick documentation lookup 快速查看文档</td>
</tr>
<tr>
<td style="text-align:left">⇧F1</td>
<td>External Doc 外部文档</td>
</tr>
<tr>
<td style="text-align:left">⌘+mouse over code</td>
<td>Brief Info 代码简短的信息</td>
</tr>
<tr>
<td style="text-align:left">⌘F1</td>
<td>Show descriptions of error or warning at caret 在光标位置处显示错误或警告的描述</td>
</tr>
<tr>
<td style="text-align:left">⌘N,⌃↵,⌃N</td>
<td>Generate code… (Getters, Setters, Constructors, hashCode/equals, toString) 生成的代码等等(Getter, Setters, Constructors, HashCode/Equals, toString)</td>
</tr>
<tr>
<td style="text-align:left">⌃O</td>
<td>Override methods</td>
</tr>
<tr>
<td style="text-align:left">⌃I</td>
<td>Implement methods</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥T</td>
<td>Surround with… (if..else, try..catch, for, synchronized, etc.)</td>
</tr>
<tr>
<td style="text-align:left">⌘/</td>
<td>Comment/uncomment with line comment (注释/取消注释)行注释</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥/</td>
<td>Comment/uncomment with block comment (注释/取消注释)块注释</td>
</tr>
<tr>
<td style="text-align:left">⌘W</td>
<td>Select successively increasing code blocks 选择代码块</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧W</td>
<td>Decrease current selection to previous state 减少当前选择到之前状态</td>
</tr>
<tr>
<td style="text-align:left">⌃⇧Q</td>
<td>Context info 上下文信息</td>
</tr>
<tr>
<td style="text-align:left">⌥↵</td>
<td>Show intention actions and quick-fixes 显示意图行动和快速修正</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥L</td>
<td>Reformat code 格式化代码</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥O</td>
<td>Optimize imports 优化导入</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥I</td>
<td>Auto-indent line(s) 自动缩进</td>
</tr>
<tr>
<td style="text-align:left">⇥/⇧⇥</td>
<td>Indent/unindent selected lines 缩进/取消缩进选中的行</td>
</tr>
<tr>
<td style="text-align:left">⌘X</td>
<td>Cut current line or selected block to clipboard 剪切当前行或选定的块复制到剪贴板</td>
</tr>
<tr>
<td style="text-align:left">⌘C</td>
<td>Copy current line or selected block to clipboard 复制当前行或选定的块复制到剪贴板</td>
</tr>
<tr>
<td style="text-align:left">⌘V</td>
<td>Paste from clipboard 从剪贴板粘贴</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧V</td>
<td>Paste from recent buffers… 从最近的缓冲区粘贴</td>
</tr>
<tr>
<td style="text-align:left">⌘D</td>
<td>Duplicate current line or selected block 重复当前行或选定的块</td>
</tr>
<tr>
<td style="text-align:left">⌘⌫</td>
<td>Delete a char at after caret 删除光标所在位置后一个字符</td>
</tr>
<tr>
<td style="text-align:left">⌘Y</td>
<td>Delete line at caret 删除光标所在位置行</td>
</tr>
<tr>
<td style="text-align:left">⌃⇧J</td>
<td>Smart line join 智能行连接</td>
</tr>
<tr>
<td style="text-align:left">⌘↵</td>
<td>Smart line split 智能行拆分</td>
</tr>
<tr>
<td style="text-align:left">⇧↵</td>
<td>Start new line 开始新一行</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧U</td>
<td>Toggle case for word at caret or selected block 将光标所在行,或者选择的块进行大小写转换</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧]/⌘⇧[</td>
<td>Select till code block end/start 选择到代码块结束/开始</td>
</tr>
<tr>
<td style="text-align:left">⌥Fn+⌫ (⌦)</td>
<td>Delete to word end 向后删除一个单词</td>
</tr>
<tr>
<td style="text-align:left">⌥⌫</td>
<td>Delete to word start/Remove a line of code 从光标处删除到单词开始</td>
</tr>
<tr>
<td style="text-align:left">⌘+/⌘-</td>
<td>Expand/collapse code block 展开／折叠代码块</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧+</td>
<td>Expand all 展开所有</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧-</td>
<td>Collapse all 折叠所有</td>
</tr>
</tbody>
</table>
<h2 id="Search-Replace"><a href="#Search-Replace" class="headerlink" title="Search/Replace"></a>Search/Replace</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⇧⇧</td>
<td>Search everywhere 强大的搜索</td>
</tr>
<tr>
<td style="text-align:left">⌘F</td>
<td>Find 查找</td>
</tr>
<tr>
<td style="text-align:left">⌘G</td>
<td>Find next 查找下一个</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧G</td>
<td>Find previous 查找上一个</td>
</tr>
<tr>
<td style="text-align:left">⌘R</td>
<td>Replace 替换</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F</td>
<td>Find in path 路径中查找</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧R</td>
<td>Replace in path 路径中替换</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧S</td>
<td>Search structurally (Ultimate Edition only) 查找结构(旗舰版专属)</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧M</td>
<td>Replace structurally (Ultimate Edition only) 替换结构(旗舰版专属)</td>
</tr>
</tbody>
</table>
<h2 id="Usage-Search"><a href="#Usage-Search" class="headerlink" title="Usage Search"></a>Usage Search</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌥F7/⌘F7</td>
<td>Find usages / Find usages in file 查找使用 / 在文件中查找使用</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F7</td>
<td>Highlight usages in file 在文件中高亮使用</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥F7</td>
<td>Show usages 显示使用</td>
</tr>
</tbody>
</table>
<h2 id="Compile-and-Run"><a href="#Compile-and-Run" class="headerlink" title="Compile and Run"></a>Compile and Run</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘F9</td>
<td>Make project (compile modifed and dependent) 构建项目(编译修改和依赖)</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F9</td>
<td>Compile selected file, package or module 编译选中的文件、包或模块</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥R</td>
<td>Select configuration and run 选择配置和运行</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥D</td>
<td>Select configuration and debug 选择配置和调试</td>
</tr>
<tr>
<td style="text-align:left">⌃R</td>
<td>Run 运行</td>
</tr>
<tr>
<td style="text-align:left">⌃D</td>
<td>Debug 调试</td>
</tr>
<tr>
<td style="text-align:left">⌃⇧R,⌃⇧D</td>
<td>Run context configuration from editor 从编辑器中配置运行环境</td>
</tr>
</tbody>
</table>
<h2 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F8</td>
<td>Step over 单步跳过</td>
</tr>
<tr>
<td style="text-align:left">F7</td>
<td>Step into 单步进入</td>
</tr>
<tr>
<td style="text-align:left">⇧F7</td>
<td>Smart step into 智能单步进入</td>
</tr>
<tr>
<td style="text-align:left">⇧F8</td>
<td>Step out 单步跳出</td>
</tr>
<tr>
<td style="text-align:left">⌥F9</td>
<td>Run to cursor 运行到光标处</td>
</tr>
<tr>
<td style="text-align:left">⌥F8</td>
<td>Evaluate expression 计算表达式</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥R</td>
<td>Resume program 恢复程序</td>
</tr>
<tr>
<td style="text-align:left">⌘F8</td>
<td>Toggle breakpoint 切换断点</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F8</td>
<td>View breakpoints 查看断点</td>
</tr>
</tbody>
</table>
<h2 id="Navigation"><a href="#Navigation" class="headerlink" title="Navigation"></a>Navigation</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘N</td>
<td>Go to class 跳转到类</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧N</td>
<td>Go to file 跳转到文件</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧⌥N</td>
<td>Go to symbol 跳转到符号</td>
</tr>
<tr>
<td style="text-align:left">⌃←/⌃→</td>
<td>Go to next/previous editor tab 上一个/下一个编辑页</td>
</tr>
<tr>
<td style="text-align:left">F12</td>
<td>Go back to previous tool window 上一个工具窗口</td>
</tr>
<tr>
<td style="text-align:left">⎋</td>
<td>Go to editor (from tool window) 从工作窗口到编辑器</td>
</tr>
<tr>
<td style="text-align:left">⇧⎋</td>
<td>Hide active or last active window 隐藏活动或最后的活动窗口</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F4</td>
<td>Close active run/messages/find/… tab 关闭活动的run/messages/find/..选项卡</td>
</tr>
<tr>
<td style="text-align:left">⌘G</td>
<td>Go to line 跳转到行</td>
</tr>
<tr>
<td style="text-align:left">⌘E</td>
<td>Recent files popup 弹出最近使用的文件</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥←/⌘⌥→</td>
<td>Navigate back/forward 前进/后退导航</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧⌫</td>
<td>Navigate to last edit location 导航到最后编辑的位置</td>
</tr>
<tr>
<td style="text-align:left">⌥F1</td>
<td>Select current file or symbol in any view 在任何视图中选择当前文件或符号</td>
</tr>
<tr>
<td style="text-align:left">⌘B,⌘Click</td>
<td>Go to declaration 跳转到声明</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥B</td>
<td>Go to implementation(s) 跳转到实现</td>
</tr>
<tr>
<td style="text-align:left">⌥Space</td>
<td>Open quick definition lookup</td>
</tr>
<tr>
<td style="text-align:left">⌃⇧B</td>
<td>Go to type declaration 跳转到类型声明 </td>
</tr>
<tr>
<td style="text-align:left">⌘U</td>
<td>Go to super-method/super-class 跳转到Super-Method/超类</td>
</tr>
<tr>
<td style="text-align:left">⌃↑/⌃↓</td>
<td>Go to previous/next method 跳转到上一个/下一个方法</td>
</tr>
<tr>
<td style="text-align:left">⌘]/⌘[</td>
<td>Move to code block end/start 移动光标代码块结束/开始</td>
</tr>
<tr>
<td style="text-align:left">⌘F12</td>
<td>File structure popup 弹出文件结构</td>
</tr>
<tr>
<td style="text-align:left">⌃H</td>
<td>Type hierarchy 类型层次结构</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧H</td>
<td>Method hierarchy 方法层次结构</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥H</td>
<td>Call hierarchy 调用层次结构</td>
</tr>
<tr>
<td style="text-align:left">F2/⇧F2</td>
<td>Next/previous highlighted error 上一个/下一个高亮错误</td>
</tr>
<tr>
<td style="text-align:left">F4/⌘↓</td>
<td>Edit source / View source 编辑/查看 源代码</td>
</tr>
<tr>
<td style="text-align:left">⌥Home</td>
<td>Show navigation bar 显示导航栏</td>
</tr>
<tr>
<td style="text-align:left">F3</td>
<td>Toggle bookmark 切换书签</td>
</tr>
<tr>
<td style="text-align:left">⌥F3</td>
<td>Toggle bookmark with mnemonic 切换书签助记符</td>
</tr>
<tr>
<td style="text-align:left">⌃0…⌃9</td>
<td>Go to numbered bookmark 跳转到编号的书签</td>
</tr>
<tr>
<td style="text-align:left">⌘F3</td>
<td>Show bookmarks 显示所有的书签</td>
</tr>
</tbody>
</table>
<h2 id="Refactoring"><a href="#Refactoring" class="headerlink" title="Refactoring"></a>Refactoring</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F5</td>
<td>Copy</td>
</tr>
<tr>
<td style="text-align:left">F6</td>
<td>Move</td>
</tr>
<tr>
<td style="text-align:left">⌘⌫</td>
<td>Safe Delete</td>
</tr>
<tr>
<td style="text-align:left">⇧F6</td>
<td>Rename</td>
</tr>
<tr>
<td style="text-align:left">⌘F6</td>
<td>Change Signature 修改签名</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥N</td>
<td>Inline 内联</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥M</td>
<td>Extract Method 抽取方法</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥V</td>
<td>Extract Variable 抽取变量</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥F</td>
<td>Extract Field 抽取字段</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥C</td>
<td>Extract Constant 抽取常量</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥P</td>
<td>Extract Parameter 抽取参数</td>
</tr>
</tbody>
</table>
<h2 id="VCS-Local-History"><a href="#VCS-Local-History" class="headerlink" title="VCS/Local History"></a>VCS/Local History</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘K</td>
<td>Commit project to VCS 提交项目到VCS</td>
</tr>
<tr>
<td style="text-align:left">⌘T</td>
<td>Update project from VCS 从VCS更新项目</td>
</tr>
<tr>
<td style="text-align:left">⌥⇧C</td>
<td>View recent changes 查看最近到变化</td>
</tr>
<tr>
<td style="text-align:left">⌃V</td>
<td>‘VCS’ quick popup VCS快速弹出</td>
</tr>
</tbody>
</table>
<h2 id="Live-Templates"><a href="#Live-Templates" class="headerlink" title="Live Templates"></a>Live Templates</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘⌥J</td>
<td>Surround with Live Template 环绕动态模版</td>
</tr>
<tr>
<td style="text-align:left">⌘J</td>
<td>Insert Live Template 插入动态模版</td>
</tr>
<tr>
<td style="text-align:left">iter</td>
<td>Java SDK 1.5的迭代风格</td>
</tr>
<tr>
<td style="text-align:left">inst</td>
<td>使用instanceof检查对象类型并且向下转型</td>
</tr>
<tr>
<td style="text-align:left">itco</td>
<td>遍历java.util.Collection的元素</td>
</tr>
<tr>
<td style="text-align:left">itit</td>
<td>遍历java.util.Iterator的元素</td>
</tr>
<tr>
<td style="text-align:left">itli</td>
<td>遍历java.util.List的元素</td>
</tr>
<tr>
<td style="text-align:left">psf</td>
<td>public static final</td>
</tr>
<tr>
<td style="text-align:left">psvm</td>
<td>public static void main</td>
</tr>
<tr>
<td style="text-align:left">thr</td>
<td>throw new</td>
</tr>
</tbody>
</table>
<h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘0…⌘9</td>
<td>Open corresponding tool window 打开相应的工具窗口</td>
</tr>
<tr>
<td style="text-align:left">⌘S</td>
<td>Save all 全部保存</td>
</tr>
<tr>
<td style="text-align:left">⌘⌥Y</td>
<td>Synchronize 同步</td>
</tr>
<tr>
<td style="text-align:left">⌃⌥F</td>
<td>Toggle full screen mode 全屏模式</td>
</tr>
<tr>
<td style="text-align:left">⌘⇧F12</td>
<td>Toggle maximizing editor 编辑窗口最大化</td>
</tr>
<tr>
<td style="text-align:left">⌥⇧F</td>
<td>Add to Favorites 添加到收藏</td>
</tr>
<tr>
<td style="text-align:left">⌥⇧I</td>
<td>Inspect current file with current profile 检查当前文件与当前配置文件</td>
</tr>
<tr>
<td style="text-align:left">⌃§,⌃`</td>
<td>Quick switch current scheme 快速转换现有组合</td>
</tr>
<tr>
<td style="text-align:left">⌘,</td>
<td>Open Settings dialog 打开设置对话框</td>
</tr>
<tr>
<td style="text-align:left">⌘;</td>
<td>Open Project Structure dialog 打开项目结构对话框</td>
</tr>
<tr>
<td style="text-align:left">⇧⌘A</td>
<td>Find Action 查找动作</td>
</tr>
<tr>
<td style="text-align:left">⌃⇥</td>
<td>Switch between tabs and tool window 标签页和工具窗口之间切换</td>
</tr>
</tbody>
</table>
<p>友情外链：<br><a href="http://wiki.jikexueyuan.com/project/intellij-idea-tutorial/" target="_blank" rel="external">极客学院－IntelliJ IDEA 使用教程</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/22/Sublime-Text-Shortcuts-for-Mac-OS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/Sublime-Text-Shortcuts-for-Mac-OS/" itemprop="url">Sublime Text Shortcuts for Mac OS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-22T17:36:16+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/Sublime-Text-Shortcuts-for-Mac-OS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/22/Sublime-Text-Shortcuts-for-Mac-OS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/22/Sublime-Text-Shortcuts-for-Mac-OS/" class="leancloud_visitors" data-flag-title="Sublime Text Shortcuts for Mac OS">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>推荐使用最新版本的Chrome/Safari或者Firefox浏览器浏览此页，否则Mac按键可能无法正常展示</li>
<li>The Latest Version of Chrome/Safari or Firefox is Recommeded.</li>
</ul>
<h2 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + X</td>
<td style="text-align:left">Cut line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ↩</td>
<td style="text-align:left">Insert line after</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + ↩</td>
<td style="text-align:left">Insert line before</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌃ + ↑</td>
<td style="text-align:left">Move line/selection up</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌃ + ↓</td>
<td style="text-align:left">Move line/selection down</td>
</tr>
<tr>
<td style="text-align:left">⌘ + L</td>
<td style="text-align:left">Select line - Repeat to select next lines</td>
</tr>
<tr>
<td style="text-align:left">⌘ + D</td>
<td style="text-align:left">Select word - Repeat to select next occurrence</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⌘ + G</td>
<td style="text-align:left">Select all occurrences of current selection</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + ↑</td>
<td style="text-align:left">Extra cursor on the line above</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + ↓</td>
<td style="text-align:left">Extra cursor on the line below</td>
</tr>
<tr>
<td style="text-align:left">⌃ + M</td>
<td style="text-align:left">Jump to closing parentheses Repeat to jump to opening parentheses</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + M</td>
<td style="text-align:left">Select all contents of the current parentheses</td>
</tr>
<tr>
<td style="text-align:left">⌃ + A, ⌘ + Left</td>
<td style="text-align:left">Move to beginning of line</td>
</tr>
<tr>
<td style="text-align:left">⌃ + E, ⌘ + Right</td>
<td style="text-align:left">Move to end of line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + K, ⌘ + K</td>
<td style="text-align:left">Delete from cursor to end of line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + K + ⌫</td>
<td style="text-align:left">Delete from cursor to start of line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ]</td>
<td style="text-align:left">Indent current line(s)</td>
</tr>
<tr>
<td style="text-align:left">⌘ + [</td>
<td style="text-align:left">Un-indent current line(s)</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + D</td>
<td style="text-align:left">Duplicate line(s)</td>
</tr>
<tr>
<td style="text-align:left">⌘ + J</td>
<td style="text-align:left">Join line below to the end of the current line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + /</td>
<td style="text-align:left">Comment/un-comment current line</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + /</td>
<td style="text-align:left">Block comment current selection</td>
</tr>
<tr>
<td style="text-align:left">⌘ + Y</td>
<td style="text-align:left">Redo, or repeat last keyboard shortcut command</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + V</td>
<td style="text-align:left">Paste and indent correctly</td>
</tr>
<tr>
<td style="text-align:left">⌃ + Space</td>
<td style="text-align:left">Select next auto-complete suggestion</td>
</tr>
<tr>
<td style="text-align:left">⌃ + U</td>
<td style="text-align:left">Soft undo; jumps to your last change before undoing change when repeated</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + Up</td>
<td style="text-align:left">Column selection up</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + Down</td>
<td style="text-align:left">Column selection down</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + W</td>
<td style="text-align:left">Wrap Selection in html tag</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + K</td>
<td style="text-align:left">Delete current line of cursor</td>
</tr>
</tbody>
</table>
<h2 id="Navigation-Goto-Anywhere"><a href="#Navigation-Goto-Anywhere" class="headerlink" title="Navigation/Goto Anywhere"></a>Navigation/Goto Anywhere</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + P or ⌘ + T</td>
<td style="text-align:left">Quick-open files by name</td>
</tr>
<tr>
<td style="text-align:left">⌘ + R</td>
<td style="text-align:left">Goto symbol Goto word in current file</td>
</tr>
<tr>
<td style="text-align:left">⌃ + G</td>
<td style="text-align:left">Goto line in current file</td>
</tr>
</tbody>
</table>
<h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + ⇧ + P</td>
<td style="text-align:left">Command Palette</td>
</tr>
<tr>
<td style="text-align:left">⌃ + `</td>
<td style="text-align:left">Python Console</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⌘ + F</td>
<td style="text-align:left">Toggle fullscreen mode</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + ⌘ + F</td>
<td style="text-align:left">Toggle distraction-free mode</td>
</tr>
<tr>
<td style="text-align:left">⌘ + K, ⌘ + B</td>
<td style="text-align:left">Toggle side bar</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + P</td>
<td style="text-align:left">Show scope in status bar</td>
</tr>
</tbody>
</table>
<h2 id="Find-Replace"><a href="#Find-Replace" class="headerlink" title="Find/Replace"></a>Find/Replace</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + F</td>
<td style="text-align:left">Find</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + F</td>
<td style="text-align:left">Replace</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + F</td>
<td style="text-align:left">Find in files</td>
</tr>
</tbody>
</table>
<h2 id="Scrolling"><a href="#Scrolling" class="headerlink" title="Scrolling"></a>Scrolling</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌃ + V</td>
<td style="text-align:left">Scroll down one page</td>
</tr>
<tr>
<td style="text-align:left">⌃ + L</td>
<td style="text-align:left">Center current line vertically in page</td>
</tr>
<tr>
<td style="text-align:left">⌘ + Down</td>
<td style="text-align:left">Scroll to end of file</td>
</tr>
<tr>
<td style="text-align:left">⌘ + Up</td>
<td style="text-align:left">Scroll to start of file</td>
</tr>
</tbody>
</table>
<h2 id="Tabs"><a href="#Tabs" class="headerlink" title="Tabs"></a>Tabs</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + ⇧ + t</td>
<td style="text-align:left">Open last closed tab</td>
</tr>
<tr>
<td style="text-align:left">⌘ + [NUM]</td>
<td style="text-align:left">Jump to tab in current group where num is 1-9</td>
</tr>
<tr>
<td style="text-align:left">⌘ + 0</td>
<td style="text-align:left">Jump to 10th tab in current group</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + [</td>
<td style="text-align:left">Cycle left through tabs</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + ]</td>
<td style="text-align:left">Cycle right through tabs</td>
</tr>
<tr>
<td style="text-align:left">^ + Tab</td>
<td style="text-align:left">Cycle up through recent tabs</td>
</tr>
<tr>
<td style="text-align:left">⇧ + ^ + Tab</td>
<td style="text-align:left">Cycle down through recent tabs</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">Find in files</td>
</tr>
</tbody>
</table>
<h2 id="Split-window"><a href="#Split-window" class="headerlink" title="Split window"></a>Split window</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + ⌥ + 1</td>
<td style="text-align:left">Revert view to single column</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + 2</td>
<td style="text-align:left">Split view into two columns</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + 3</td>
<td style="text-align:left">Split view into three columns</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + 4</td>
<td style="text-align:left">Split view into four columns</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌥ + 5</td>
<td style="text-align:left">Set view to grid (4 groups)</td>
</tr>
<tr>
<td style="text-align:left">⌃ + [NUM]</td>
<td style="text-align:left">Jump to group where num is 1-4</td>
</tr>
<tr>
<td style="text-align:left">⌃ + ⇧ + [NUM]</td>
<td style="text-align:left">Move file to specified group where num is 1-4</td>
</tr>
</tbody>
</table>
<h2 id="Bookmarks"><a href="#Bookmarks" class="headerlink" title="Bookmarks"></a>Bookmarks</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + F2</td>
<td style="text-align:left">Toggle bookmark</td>
</tr>
<tr>
<td style="text-align:left">F2</td>
<td style="text-align:left">Next bookmark</td>
</tr>
<tr>
<td style="text-align:left">⇧ + F2</td>
<td style="text-align:left">Previous bookmark</td>
</tr>
<tr>
<td style="text-align:left">⇧ + ⌘ + F2</td>
<td style="text-align:left">Clear bookmarks</td>
</tr>
</tbody>
</table>
<h2 id="Text-manipulation"><a href="#Text-manipulation" class="headerlink" title="Text manipulation"></a>Text manipulation</h2><hr>
<table>
<thead>
<tr>
<th style="text-align:left">Keypress</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + K, ⌘ + U</td>
<td style="text-align:left">Transform to Uppercase</td>
</tr>
<tr>
<td style="text-align:left">⌘ + K, ⌘ + L</td>
<td style="text-align:left">Transform to Lowercase</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⌃ + up, ⌘ + ⌃ + down</td>
<td style="text-align:left">Clip text upwards / downwards</td>
</tr>
</tbody>
</table>
<p>REF:</p>
<ol>
<li><a href="http://www.sublimetext.com/docs/2/index.html" target="_blank" rel="external">http://www.sublimetext.com/docs/2/index.html</a></li>
<li><a href="http://docs.sublimetext.info/en/latest/index.html" target="_blank" rel="external">http://docs.sublimetext.info/en/latest/index.html</a></li>
<li><a href="https://tutsplus.com/course/improve-workflow-in-sublime-text-2/" target="_blank" rel="external">https://tutsplus.com/course/improve-workflow-in-sublime-text-2/</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/22/开篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/22/开篇/" itemprop="url">开篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-22T16:45:53+08:00">
                2016-06-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/22/开篇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/22/开篇/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/22/开篇/" class="leancloud_visitors" data-flag-title="开篇">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>许久以来一直有个想法，将工作以来遇到的点点滴滴形成Blog，但因为各种原因，以及懒癌发作，拖到了现在。</p>
<p>好在之前将一些东西简单记录了笔记，这次一起整理一下，逐步写出来，也锻炼下写作能力，给后半生找个寄托，也给后来人留点什么，不枉此生蹉跎！自勉～！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jefferlau.me/2016/06/21/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffer Lau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="谦和斋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/21/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-21T23:21:38+08:00">
                2016-06-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/21/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/06/21/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/06/21/hello-world/" class="leancloud_visitors" data-flag-title="Hello World">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jeffer Lau" />
          <p class="site-author-name" itemprop="name">Jeffer Lau</p>
           
              <p class="site-description motion-element" itemprop="description">成长源于经历的点点滴滴</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial" title="IntelliJ IDEA 学习" target="_blank">IntelliJ IDEA 学习</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/kimmking" title="kimmking" target="_blank">kimmking</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.zhitbar.com/" title="马某人学习数据库" target="_blank">马某人学习数据库</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/judasn/Linux-Tutorial" title="程序员眼中的 Linux" target="_blank">程序员眼中的 Linux</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeffer Lau</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://jefferlau.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("SbzEtfMyiJG5kAVWY3PpLcTi-MdYXbMMI", "w8389TITmz3Iz71OcVQT8jjS");AV.useAVCloudUS();</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
